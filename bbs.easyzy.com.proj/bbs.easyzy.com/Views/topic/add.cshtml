@{
    ViewBag.Title = "易作业论坛-新增话题";
}
<link href="/Content/bbs.css" rel="stylesheet" />
<script src="/scripts/kindeditor/kindeditor-min.js" charset="utf-8" type="text/javascript"></script>
<div class="container clearfix" style="width:1200px;">
    <!--主内容-->
    <div class="main-content">
        <div class="table-con">
            <table class="table-1 add-topic">
                <tr>
                    <td class="td-1">邀请回复</td>
                    <td class="td-2"><input id="title" name="title" class="txt" type="text" placeholder="想邀请谁回答请@他，最多5人" /></td>
                </tr>
                <tr>
                    <td class="td-1">标题</td>
                    <td class="td-2"><input id="title" name="title" class="txt" type="text" /></td>
                </tr>
                <tr>
                    <td class="td-1">内容</td>
                    <td class="td-2"><textarea id="topic" name="topic"></textarea></td>
                </tr>
                <tr>
                    <td class="td-1">标签</td>
                    <td class="td-2">
                        年级：
                        <select id="GradeSelecter" style="width:100px; margin-top:10px;">
                            <option value="0"></option>
                            @foreach (var g in ViewBag.Grades)
                            {
                                <option value="@g.Key">@g.Value</option>
                            }
                        </select> 
                        学科：
                        <select id="SubjectSelecter" style="width:100px; margin-top:10px;">
                            <option value="0"></option>
                            @foreach (var s in ViewBag.Subjects)
                            {
                                <option value="@s.Key">@s.Value</option>
                            }
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="td-2" colspan="2" style="text-align:center;"><input class="btn submit" type="button" value="提交" /></td>
                </tr>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">

    var editor1;
    KindEditor.ready(function (K) {
        editor1 = K.create('#topic', {
            cssPath: '/scripts/kindeditor/plugins/code/prettify.css',
            uploadJson: '/scripts/kindeditor/upload_picture.ashx',
            fileManagerJson: '/scripts/kindeditor/file_manager_json.ashx',
            allowFileManager: true
        });
        //prettyPrint();
    });

    function check() {
        var Title = $("#title").val();
        if (Title.length > 50) {
            dialogAlert("标题不能超过50个字！")
            return false;
        }
        else if (trim(Title).length == 0) {
            dialogAlert("标题不能为空！")
            return false;
        }

        var Topic = editor1.html();
        if (Topic.length > 8000) {
            dialogAlert("内容太长了！")
            return false;
        }
        return true;
    }

    $(".submit").on("click", function () {
        if (check()) {
            var Title = $("#title").val();
            var Topic = editor1.html();
            var TopicText = editor1.text();
            
            Topic = encodeURI(Topic);
            TopicText = encodeURI(TopicText);

            $.post("AddTopic",
                { title: Title, topic: Topic, topicText: TopicText },
                function (data) {
                    if (data.status != 0) {
                        dialogAlert(data.message);
                    }
                })
        }
    })

</script>