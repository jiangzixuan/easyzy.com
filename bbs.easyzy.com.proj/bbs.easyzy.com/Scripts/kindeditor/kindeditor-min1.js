(function(k,c){if(k.KindEditor)return;if(!k.console)k.console={};if(!console.log)console.log=function(){};var mb="4.1.7 (2013-04-21)",u=navigator.userAgent.toLowerCase(),e=u.indexOf("msie")>-1&&u.indexOf("opera")==-1,N=u.indexOf("gecko")>-1&&u.indexOf("khtml")==-1,H=u.indexOf("applewebkit")>-1,Ib=u.indexOf("opera")>-1,jd=u.indexOf("mobile")>-1,qd=/ipad|iphone|ipod/.test(u),A=document.compatMode!="CSS1Compat",sc=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(u),j=sc?sc[1]:"0",ob=(new Date).getTime();function M(a){return!a?false:Object.prototype.toString.call(a)==="[object Array]"}function ic(a){return!a?false:Object.prototype.toString.call(a)==="[object Function]"}function w(d,b){for(var a=0,c=b.length;a<c;a++)if(d===b[a])return a;return-1}function b(a,d){if(M(a)){for(var b=0,e=a.length;b<e;b++)if(d.call(a[b],b,a[b])===false)break}else for(var c in a)if(a.hasOwnProperty(c))if(d.call(a[c],c,a[c])===false)break}function n(a){return a.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function oc(d,b,a){a=a===c?",":a;return(a+b+a).indexOf(a+d+a)>=0}function g(a,b){b=b||"px";return a&&/^\d+$/.test(a)?a+b:a}function f(b){var a;return b&&(a=/(\d+)/.exec(b))?parseInt(a[1],10):0}function l(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function X(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function Y(a){var c=a.split("-");a="";b(c,function(c,b){a+=c>0?b.charAt(0).toUpperCase()+b.substr(1):b});return a}function nb(b){function a(b){var a=parseInt(b,10).toString(16).toUpperCase();return a.length>1?a:"0"+a}return b.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/ig,function(e,b,c,d){return"#"+a(b)+a(c)+a(d)})}function i(f,a){a=a===c?",":a;var e={},g=M(f)?f:f.split(a),d;b(g,function(c,b){if(d=/^(\d+)\.\.(\d+)$/.exec(b))for(var a=parseInt(d[1],10);a<=parseInt(d[2],10);a++)e[a.toString()]=true;else e[b]=true});return e}function Eb(b,a){return Array.prototype.slice.call(b,a||0)}function d(a,b){return a===c?b:a}function Yc(a){return!a||/[<>"]/.test(a)}function ed(a,b){return a.indexOf("?")>=0?a+"&"+b:a+"?"+b}function p(e,a,d){if(!d){d=a;a=null}var c;if(a){var f=function(){};f.prototype=a.prototype;c=new f;b(d,function(a,b){c[a]=b})}else c=d;c.constructor=e;e.prototype=c;e.parent=a?a.prototype:null}function Cc(a){var c;if(c=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(a))a=c[0];var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.lastIndex=0;if(b.test(a))a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+a+")");throw"JSON parse error";}var B=Math.round,a={DEBUG:false,VERSION:mb,IE:e,GECKO:N,WEBKIT:H,OPERA:Ib,V:j,TIME:ob,each:b,isArray:M,isFunction:ic,inArray:w,inString:oc,trim:n,addUnit:g,removeUnit:f,escape:l,unescape:X,toCamel:Y,toHex:nb,toMap:i,toArray:Eb,undef:d,invalidUrl:Yc,addParam:ed,extend:p,json:Cc},Sb=i("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),Ub=i("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),Tb=i("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),Yb=i("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),Kc=i("img,table,input,textarea,button"),wb=i("pre,style,script"),fb=i("html,head,body,td,tr,table,ol,ul,li"),sd=i("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),Nc=i("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),Oc=i("input,button,textarea,select");function Wc(){for(var c=document.getElementsByTagName("script"),a,b=0,d=c.length;b<d;b++){a=c[b].src||"";if(/kindeditor[\w\-\.]*\.js/.test(a))return a.substring(0,a.lastIndexOf("/")+1)}return""}a.basePath=Wc();a.options={designMode:true,fullscreenMode:false,filterMode:true,wellFormatMode:true,shadowMode:true,loadStyleMode:true,basePath:a.basePath,themesPath:a.basePath+"themes/",langPath:a.basePath+"lang/",pluginsPath:a.basePath+"plugins/",themeType:"default",langType:"zh_CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:true,fullscreenShortcut:false,bodyClass:"ke-content",indentChar:"\t",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","wordimport","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","flv","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess","autostart","allowfullscreen"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var lc=false,Wb=i("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),Hc=i("33..40"),qb={};b(Wb,function(a,b){qb[a]=b});b(Hc,function(a,b){qb[a]=b});function cd(a,b,c){if(a.addEventListener)a.addEventListener(b,c,lc);else a.attachEvent&&a.attachEvent("on"+b,c)}function hb(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,lc);else a.detachEvent&&a.detachEvent("on"+b,c)}var Vc="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(",");function zc(b,a){this.init(b,a)}p(zc,{init:function(g,h){var a=this,f=g.ownerDocument||g.document||g;a.event=h;b(Vc,function(c,b){a[b]=h[b]});if(!a.target)a.target=a.srcElement||f;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){var e=f.documentElement,d=f.body;a.pageX=a.clientX+(e&&e.scrollLeft||d&&d.scrollLeft||0)-(e&&e.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(e&&e.scrollTop||d&&d.scrollTop||0)-(e&&e.clientTop||d&&d.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==c)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;switch(a.which){case 186:a.which=59;break;case 187:case 107:case 43:a.which=61;break;case 189:case 45:a.which=109;break;case 42:a.which=106;break;case 47:a.which=111;break;case 78:a.which=110}if(a.which>=96&&a.which<=105)a.which-=48},preventDefault:function(){var a=this.event;a.preventDefault&&a.preventDefault();a.returnValue=false},stopPropagation:function(){var a=this.event;a.stopPropagation&&a.stopPropagation();a.cancelBubble=true},stop:function(){this.preventDefault();this.stopPropagation()}});var gb="kindeditor_"+ob,rc=0,h={};function Hb(a){return a[gb]||null}function md(a){a[gb]=++rc;return rc}function qc(a){try{delete a[gb]}catch(b){a.removeAttribute&&a.removeAttribute(gb)}}function O(d,f,g){if(f.indexOf(",")>=0){b(f.split(","),function(){O(d,this,g)});return}var e=Hb(d);if(!e)e=md(d);if(h[e]===c)h[e]={};var a=h[e][f];if(a&&a.length>0)hb(d,f,a[0]);else{h[e][f]=[];h[e].el=d}a=h[e][f];if(a.length===0)a[0]=function(e){var f=e?new zc(d,e):c;b(a,function(b,a){b>0&&a&&a.call(d,f)})};w(g,a)<0&&a.push(g);cd(d,f,a[0])}function bb(f,d,g){if(d&&d.indexOf(",")>=0){b(d.split(","),function(){bb(f,this,g)});return}var a=Hb(f);if(!a)return;if(d===c){if(a in h){b(h[a],function(b,a){b!="el"&&a.length>0&&hb(f,b,a[0])});delete h[a];qc(f)}return}if(!h[a])return;var e=h[a][d];if(e&&e.length>0){if(g===c){hb(f,d,e[0]);delete h[a][d]}else{b(e,function(a,b){a>0&&b===g&&e.splice(a,1)});if(e.length==1){hb(f,d,e[0]);delete h[a][d]}}var i=0;b(h[a],function(){i++});if(i<2){delete h[a];qc(f)}}}function Bc(e,c){if(c.indexOf(",")>=0){b(c.split(","),function(){Bc(e,this)});return}var d=Hb(e);if(!d)return;var a=h[d][c];h[d]&&a&&a.length>0&&a[0]()}function Kb(b,a,c){var d=this;a=/^\d{2,}$/.test(a)?a:a.toUpperCase().charCodeAt(0);O(b,"keydown",function(d){if(d.ctrlKey&&d.which==a&&!d.shiftKey&&!d.altKey){c.call(b);d.stop()}})}function ld(f){var b=false;function a(){if(!b){b=true;f(KindEditor)}}function c(){if(!b){try{document.documentElement.doScroll("left")}catch(d){setTimeout(c,100);return}a()}}function e(){document.readyState==="complete"&&a()}if(document.addEventListener)O(document,"DOMContentLoaded",a);else if(document.attachEvent){O(document,"readystatechange",e);var d=false;try{d=k.frameElement==null}catch(g){}document.documentElement.doScroll&&d&&c()}O(k,"load",a)}e&&k.attachEvent("onunload",function(){b(h,function(b,a){a.el&&bb(a.el)})});a.ctrl=Kb;a.ready=ld;function L(c){var b={},e=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,a;while(a=e.exec(c)){var d=n(a[1].toLowerCase()),f=n(nb(a[2]));b[d]=f}return b}function q(e){var b={},d=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,a;while(a=d.exec(e)){var c=(a[1]||a[2]||a[4]||a[6]).toLowerCase(),f=(a[2]?a[3]:a[4]?a[5]:a[7])||"";b[c]=f}return b}function Mc(a,b){if(/\s+class\s*=/.test(a))a=a.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(e,c,a,d){return(" "+a+" ").indexOf(" "+b+" ")<0?a===""?c+b+d:c+a+" "+b+d:e});else a=a.substr(0,a.length-1)+' class="'+b+'">';return a}function dd(c){var a="";b(L(c),function(b,c){a+=b+":"+c+";"});return a}function W(a,f,b,e){f=d(f,"").toLowerCase();if(a.substr(0,5)!="data:")a=a.replace(/([^:])\/\//g,"$1/");if(w(f,["absolute","relative","domain"])<0)return a;b=b||location.protocol+"//"+location.host;if(e===c){var j=location.pathname.match(/^(\/.*)\//);e=j?j[1]:""}var g;if(g=/^(\w+:\/\/[^\/]*)/.exec(a)){if(g[1]!==b)return a}else if(/^\w+:/.test(a))return a;function i(e){for(var d=e.split("/"),a=[],c=0,f=d.length;c<f;c++){var b=d[c];if(b=="..")a.length>0&&a.pop();else b!==""&&b!="."&&a.push(b)}return"/"+a.join("/")}if(/^\//.test(a))a=b+i(a.substr(1));else if(!/^\w+:\/\//.test(a))a=b+i(e+"/"+a);function h(b,f){if(a.substr(0,b.length)===b){for(var d=[],i=0;i<f;i++)d.push("..");var c=".";if(d.length>0)c+="/"+d.join("/");if(e=="/")c+="/";return c+a.substr(b.length)}else if(g=/^(.*)\//.exec(b))return h(g[1],++f)}if(f==="relative")a=h(b+e,0).substr(2);else if(f==="absolute")if(a.substr(0,b.length)===b)a=a.substr(b.length);return a}function D(a,g,j,h,f){j=j||"";h=d(h,false);f=d(f,"\t");var k="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/ig,function(d,a,b,c){return a+b.replace(/<(?:br|br\s[^>]*)>/ig,"\n")+c});a=a.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/ig,"</p>");a=a.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/ig,"$1<br />$2");a=a.replace(/\u200B/g,"");a=a.replace(/\u00A9/g,"&copy;");var c={};if(g){b(g,function(d,f){for(var b=d.split(","),a=0,e=b.length;a<e;a++)c[b[a]]=i(f)});if(!c.script)a=a.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/ig,"");if(!c.style)a=a.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/ig,"")}var l=/([ \t\n\r]*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>([ \t\n\r]*)/g,e=[];a=a.replace(l,function(x,y,z,A,B,s,C){var u=x,l=y||"",m=z||"",a=A.toLowerCase(),r=B||"",p=s?" "+s:"",i=C||"";if(g&&!c[a])return"";if(p===""&&Tb[a])p=" /";if(Sb[a]){if(l)l=" ";if(i)i=" "}if(wb[a])if(m)i="\n";else l="\n";if(h&&a=="br")i="\n";if(Ub[a]&&!wb[a])if(h){if(m&&e.length>0&&e[e.length-1]===a)e.pop();else e.push(a);l="\n";i="\n";for(var t=0,v=m?e.length:e.length-1;t<v;t++){l+=f;if(!m)i+=f}if(p)e.pop();else if(!m)i+=f}else l=i="";if(r!==""){var d=q(u);if(a==="font"){var o={},n="";b(d,function(a,b){if(a==="color"){o.color=b;delete d[a]}if(a==="size"){o["font-size"]=k[parseInt(b,10)-1]||"";delete d[a]}if(a==="face"){o["font-family"]=b;delete d[a]}if(a==="style")n=b});if(n&&!/;$/.test(n))n+=";";b(o,function(b,a){if(a==="")return;if(/\s/.test(a))a="'"+a+"'";n+=b+":"+a+";"});d.style=n}b(d,function(e,h){if(Nc[e])d[e]=e;if(w(e,["src","href"])>=0)d[e]=W(h,j);if(g&&e!=="style"&&!c[a]["*"]&&!c[a][e]||a==="body"&&e==="contenteditable"||/^kindeditor_\d+$/.test(e))delete d[e];if(e==="style"&&h!==""){var f=L(h);b(f,function(b){if(g&&!c[a].style&&!c[a]["."+b])delete f[b]});var i="";b(f,function(a,b){i+=a+":"+b+";"});d.style=i}});r="";b(d,function(b,a){if(b==="style"&&a==="")return;a=a.replace(/"/g,"&quot;");r+=" "+b+'="'+a+'"'})}if(a==="font")a="span";return l+"<"+m+a+r+p+">"+i});a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/ig,function(d,a,b,c){return a+b.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+c});a=a.replace(/\n\s*\n/g,"\n");a=a.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n");return n(a)}function cc(a,b){a=a.replace(/<meta[\s\S]*?>/ig,"").replace(/<![\s\S]*?>/ig,"").replace(/<style[^>]*>[\s\S]*?<\/style>/ig,"").replace(/<script[^>]*>[\s\S]*?<\/script>/ig,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/ig,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/ig,"").replace(/<xml>[\s\S]*?<\/xml>/ig,"").replace(/<(?:table|td)[^>]*>/ig,function(a){return a.replace(/border-bottom:([#\w\s]+)/ig,"border:$1")});return D(a,b)}function nc(a){return/\.(rm|rmvb)(\?|$)/i.test(a)?"audio/x-pn-realaudio-plugin":/\.(swf)(\?|$)/i.test(a)?"application/x-shockwave-flash":/\.(flv)(\?|$)/i.test(a)?"application/x-shockwave-flv":"video/x-ms-asf-plugin"}function Zc(a){return/realaudio/i.test(a)?"ke-rm":/flash/i.test(a)?"ke-flash":/flv/i.test(a)?"ke-flv":"ke-media"}function jc(a){return q(unescape(a))}function yb(c){var a="<embed ";b(c,function(b,c){a+=b+'="'+c+'" '});a+="/>";return a}function pc(f,a){var e=a.width,d=a.height,h=a.type||nc(a.src),g=yb(a),b="";if(e>0)b+="width:"+e+"px;";if(d>0)b+="height:"+d+"px;";var c='<img class="'+Zc(h)+'" src="'+f+'" ';if(b!=="")c+='style="'+b+'" ';c+='data-ke-tag="'+escape(g)+'" alt="" />';return c}function pd(c,a){var b=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return a?b(a):b}a.formatUrl=W;a.formatHtml=D;a.getCssList=L;a.getAttrList=q;a.mediaType=nc;a.mediaAttrs=jc;a.mediaEmbed=yb;a.mediaImg=pc;a.clearMsWord=cc;a.tmpl=pd;function ib(b,a){if(b.nodeType==9&&a.nodeType!=9)return true;while(a=a.parentNode)if(a==b)return true;return false}var Vb=document.createElement("div");Vb.setAttribute("className","t");var Ic=Vb.className!=="t";function lb(c,a){a=a.toLowerCase();var b=null;if(!Ic&&c.nodeName.toLowerCase()!="script"){var e=c.ownerDocument.createElement("div");e.appendChild(c.cloneNode(false));var d=q(X(e.innerHTML));if(a in d)b=d[a]}else try{b=c.getAttribute(a,2)}catch(f){b=c.getAttribute(a,1)}if(a==="style"&&b!==null)b=dd(b);return b}function jb(y,d){var r=y.split(",");if(r.length>1){var k=[];b(r,function(){b(jb(this,d),function(){w(this,k)<0&&k.push(this)})});return k}d=d||document;function v(a){return typeof a!="string"?a:a.replace(/([^\w\-])/g,"\\$1")}function l(a){return a.replace(/\\/g,"")}function n(a,b){return a==="*"||a.toLowerCase()===v(b.toLowerCase())}function x(f,e,b){var c=[],d=b.ownerDocument||b,a=d.getElementById(l(f));if(a)n(e,a.nodeName)&&ib(b,a)&&c.push(a);return c}function s(f,h,d){var j=d.ownerDocument||d,g=[],c,a,e,b;if(d.getElementsByClassName){c=d.getElementsByClassName(l(f));for(a=0,e=c.length;a<e;a++){b=c[a];n(h,b.nodeName)&&g.push(b)}}else if(j.querySelectorAll){c=j.querySelectorAll((d.nodeName!=="#document"?d.nodeName+" ":"")+h+"."+f);for(a=0,e=c.length;a<e;a++){b=c[a];ib(d,b)&&g.push(b)}}else{c=d.getElementsByTagName(h);f=" "+f+" ";for(a=0,e=c.length;a<e;a++){b=c[a];if(b.nodeType==1){var i=b.className;i&&(" "+i+" ").indexOf(f)>-1&&g.push(b)}}}return g}function B(f,i,b){for(var d=[],g=b.ownerDocument||b,e=g.getElementsByName(l(f)),a,c=0,h=e.length;c<h;c++){a=e[c];if(n(i,a.nodeName)&&ib(b,a))a.getAttributeNode("name")&&d.push(a)}return d}function u(e,f,i,g){for(var b=[],d=g.getElementsByTagName(i),a,c=0,h=d.length;c<h;c++){a=d[c];if(a.nodeType==1)if(f===null)lb(a,e)!==null&&b.push(a);else f===v(lb(a,e))&&b.push(a)}return b}function o(e,c){var b=[],a;a=/^((?:\\.|[^.#\s\[<>])+)/.exec(e);var d=a?a[1]:"*";if(a=/#((?:[\w\-]|\\.)+)$/.exec(e))b=x(a[1],d,c);else if(a=/\.((?:[\w\-]|\\.)+)$/.exec(e))b=s(a[1],d,c);else if(a=/\[((?:[\w\-]|\\.)+)\]/.exec(e))b=u(a[1].toLowerCase(),null,d,c);else if(a=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(e)){var f=a[1].toLowerCase(),g=a[2];if(f==="id")b=x(g,d,c);else if(f==="class")b=s(g,d,c);else if(f==="name")b=B(g,d,c);else b=u(f,g,d,c)}else for(var j=c.getElementsByTagName(d),h,i=0,k=j.length;i<k;i++){h=j[i];h.nodeType==1&&b.push(h)}return b}var c=[],p,C=/((?:\\.|[^\s>])+|[\s>])/g;while(p=C.exec(y))p[1]!==" "&&c.push(p[1]);var a=[];if(c.length==1)return o(c[0],d);var t=false,f,g,m,q,j,e,h,i,D,z,A;for(e=0,lenth=c.length;e<lenth;e++){f=c[e];if(f===">"){t=true;continue}if(e>0){g=[];for(h=0,z=a.length;h<z;h++){q=a[h];m=o(f,q);for(i=0,A=m.length;i<A;i++){j=m[i];if(t)q===j.parentNode&&g.push(j);else g.push(j)}}a=g}else a=o(f,d);if(a.length===0)return[]}return a}function kd(b,c){var a=jb(b,c);return a.length>0?a[0]:null}a.query=kd;a.queryAll=jb;function t(b){return a(b)[0]}function F(a){return!a?document:a.ownerDocument||a.document||a}function G(a){if(!a)return k;var b=F(a);return b.parentWindow||b.defaultView}function gd(b,c){if(b.nodeType!=1)return;var e=F(b);try{b.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+c;var d=e.getElementById("__kindeditor_temp_tag__");d.parentNode.removeChild(d)}catch(f){a(b).empty();a("@"+c,e).each(function(){b.appendChild(this)})}}function Cb(b,a){return oc(a,b.className," ")}function Db(c,a,b){if(e&&j<8&&a.toLowerCase()=="class")a="className";c.setAttribute(a,""+b)}function bd(b,a){if(e&&j<8&&a.toLowerCase()=="class")a="className";Db(b,a,"");b.removeAttribute(a)}function fc(a){return!a||!a.nodeName?"":a.nodeName.toLowerCase()}function Uc(a,e){var g=this,f=G(a),b=Y(e),c="";if(f.getComputedStyle){var d=f.getComputedStyle(a,null);c=d[b]||d.getPropertyValue(e)||a.style[b]}else if(a.currentStyle)c=a.currentStyle[b]||a.style[b];return c}function xc(a){return!!Oc[fc(a)]}function o(a){a=a||document;return A?a.body:a.documentElement}function I(a){a=a||document;var b,c;if(e||Ib){b=o(a).scrollLeft;c=o(a).scrollTop}else{b=G(a).scrollX;c=G(a).scrollY}return{x:b,y:c}}function m(a){this.init(a)}p(m,{init:function(b){var a=this;b=M(b)?b:[b];for(var d=0,c=0,e=b.length;c<e;c++)if(b[c]){a[c]=b[c].constructor===m?b[c][0]:b[c];d++}a.length=d;a.doc=F(a[0]);a.name=fc(a[0]);a.type=a.length>0?a[0].nodeType:null;a.win=G(a[0])},each:function(c){for(var a=this,b=0;b<a.length;b++)if(c.call(a[b],b,a[b])===false)return a;return a},bind:function(a,b){this.each(function(){O(this,a,b)});return this},unbind:function(a,b){this.each(function(){bb(this,a,b)});return this},fire:function(a){if(this.length<1)return this;Bc(this[0],a);return this},hasAttr:function(a){return this.length<1?false:!!lb(this[0],a)},attr:function(d,e){var a=this;if(d===c)return q(a.outer());if(typeof d==="object"){b(d,function(b,c){a.attr(b,c)});return a}if(e===c){e=a.length<1?null:lb(a[0],d);return e===null?"":e}a.each(function(){Db(this,d,e)});return a},removeAttr:function(a){this.each(function(){bd(this,a)});return this},"get":function(a){return this.length<1?null:this[a||0]},eq:function(a){return this.length<1?null:this[a]?new m(this[a]):null},hasClass:function(a){return this.length<1?false:Cb(this[0],a)},addClass:function(a){this.each(function(){if(!Cb(this,a))this.className=n(this.className+" "+a)});return this},removeClass:function(a){this.each(function(){if(Cb(this,a))this.className=n(this.className.replace(new RegExp("(^|\\s)"+a+"(\\s|$)")," "))});return this},html:function(b){var a=this;if(b===c)return a.length<1||a.type!=1?"":D(a[0].innerHTML);a.each(function(){gd(this,b)});return a},text:function(){var a=this;return a.length<1?"":e?a[0].innerText:a[0].textContent},hasVal:function(){return this.length<1?false:xc(this[0])},val:function(b){var a=this;if(b===c)return a.length<1?"":a.hasVal()?a[0].value:a.attr("value");else{a.each(function(){if(xc(this))this.value=b;else Db(this,"value",b)});return a}},css:function(d,e){var a=this;if(d===c)return L(a.attr("style"));if(typeof d==="object"){b(d,function(b,c){a.css(b,c)});return a}if(e===c)return a.length<1?"":a[0].style[Y(d)]||Uc(a[0],d)||"";a.each(function(){this.style[Y(d)]=e});return a},width:function(b){var a=this;return b===c?a.length<1?0:a[0].offsetWidth:a.css("width",g(b))},height:function(b){var a=this;return b===c?a.length<1?0:a[0].offsetHeight:a.css("height",g(b))},opacity:function(a){this.each(function(){if(this.style.opacity===c)this.style.filter=a==1?"":"alpha(opacity="+a*100+")";else this.style.opacity=a==1?"":a});return this},data:function(a,d){var b=this;a="kindeditor_data_"+a;if(d===c)return b.length<1?null:b[0][a];this.each(function(){this[a]=d});return b},pos:function(){var d=this,a=d[0],b=0,c=0;if(a)if(a.getBoundingClientRect){var e=a.getBoundingClientRect(),f=I(d.doc);b=e.left+f.x;c=e.top+f.y}else while(a){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}return{x:B(b),y:B(c)}},clone:function(a){return this.length<1?new m([]):new m(this[0].cloneNode(a))},append:function(a){this.each(function(){this.appendChild&&this.appendChild(t(a))});return this},appendTo:function(a){this.each(function(){t(a).appendChild(this)});return this},before:function(a){this.each(function(){this.parentNode.insertBefore(t(a),this)});return this},after:function(a){this.each(function(){if(this.nextSibling)this.parentNode.insertBefore(t(a),this.nextSibling);else this.parentNode.appendChild(t(a))});return this},replaceWith:function(c){var b=[];this.each(function(e,a){bb(a);var d=t(c);a.parentNode.replaceChild(d,a);b.push(d)});return a(b)},empty:function(){var a=this;a.each(function(d,b){var a=b.firstChild;while(a){if(!b.parentNode)return;var c=a.nextSibling;a.parentNode.removeChild(a);a=c}});return a},remove:function(b){var a=this;a.each(function(f,c){if(!c.parentNode)return;bb(c);if(b){var d=c.firstChild;while(d){var e=d.nextSibling;c.parentNode.insertBefore(d,c);d=e}}c.parentNode.removeChild(c);delete a[f]});a.length=0;return a},show:function(b){var a=this;if(b===c)b=a._originDisplay||"";return a.css("display")!="none"?a:a.css("display",b)},hide:function(){var a=this;if(a.length<1)return a;a._originDisplay=a[0].style.display;return a.css("display","none")},outer:function(){var a=this;if(a.length<1)return"";var b=a.doc.createElement("div"),c;b.appendChild(a[0].cloneNode(true));c=D(b.innerHTML);b=null;return c},isSingle:function(){return!!Tb[this.name]},isInline:function(){return!!Sb[this.name]},isBlock:function(){return!!Ub[this.name]},isStyle:function(){return!!Yb[this.name]},isControl:function(){return!!Kc[this.name]},contains:function(a){return this.length<1?false:ib(this[0],t(a))},parent:function(){if(this.length<1)return null;var a=this[0].parentNode;return a?new m(a):null},children:function(){if(this.length<1)return new m([]);var b=[],a=this[0].firstChild;while(a){(a.nodeType!=3||n(a.nodeValue)!=="")&&b.push(a);a=a.nextSibling}return new m(b)},first:function(){var a=this.children();return a.length>0?a.eq(0):null},last:function(){var a=this.children();return a.length>0?a.eq(a.length-1):null},index:function(){if(this.length<1)return-1;var b=-1,a=this[0];while(a){b++;a=a.previousSibling}return b},prev:function(){if(this.length<1)return null;var a=this[0].previousSibling;return a?new m(a):null},next:function(){if(this.length<1)return null;var a=this[0].nextSibling;return a?new m(a):null},scan:function(d,a){if(this.length<1)return;a=a===c?true:a;function b(e){var c=a?e.firstChild:e.lastChild;while(c){var f=a?c.nextSibling:c.previousSibling;if(d(c)===false)return false;if(b(c)===false)return false;c=f}}b(this[0]);return this}});b("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),function(b,a){m.prototype[a]=function(b){return b?this.bind(a,b):this.fire(a)}});var rd=a;a=function(a,b){if(a===c||a===null)return;function d(a){if(!a[0])a=[];return new m(a)}if(typeof a==="string"){if(b)b=t(b);var i=a.length;if(a.charAt(0)==="@")a=a.substr(1);if(a.length!==i||/<.+>/.test(a)){var j=b?b.ownerDocument||b:document,e=j.createElement("div"),h=[];e.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+a;for(var f=0,k=e.childNodes.length;f<k;f++){var g=e.childNodes[f];if(g.id=="__kindeditor_temp_tag__")continue;h.push(g)}return d(h)}return d(jb(a,b))}if(a&&a.constructor===m)return a;if(a.toArray)a=a.toArray();return M(a)?d(a):d(Eb(arguments))};b(rd,function(b,c){a[b]=c});a.NodeClass=m;k.KindEditor=a;var R=0,T=1,K=2,S=3,bc=0;function Rb(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;return a}function rb(a,b,g){var p=a.doc,c=[];function d(e,d,h){var k=e.nodeValue.length,f;if(b){var j=e.cloneNode(true);if(d>0)f=j.splitText(d);else f=j;h<k&&f.splitText(h-d)}if(g){var i=e;if(d>0){i=e.splitText(d);a.setStart(e,d)}if(h<k){var l=i.splitText(h-d);a.setEnd(l,0)}c.push(i)}return f}function q(){g&&a.up().collapse(true);for(var d=0,e=c.length;d<e;d++){var b=c[d];b.parentNode&&b.parentNode.removeChild(b)}}var e=a.cloneRange().down(),k=-1,f=-1,h=-1,m=-1,j=a.commonAncestor(),i=p.createDocumentFragment();if(j.nodeType==3){var r=d(j,a.startOffset,a.endOffset);b&&i.appendChild(r);q();return b?i:a}function o(t,q){var i=t.firstChild,r;while(i){var j=(new s(p)).selectNode(i);k=j.compareBoundaryPoints(T,a);if(k>=0&&f<=0)f=j.compareBoundaryPoints(R,a);if(f>=0&&h<=0)h=j.compareBoundaryPoints(K,a);if(h>=0&&m<=0)m=j.compareBoundaryPoints(S,a);if(m>=0)return false;r=i.nextSibling;if(k>0)if(i.nodeType==1)if(f>=0&&h<=0){b&&q.appendChild(i.cloneNode(true));g&&c.push(i)}else{var n;if(b){n=i.cloneNode(false);q.appendChild(n)}if(o(i,n)===false)return false}else if(i.nodeType==3){var l;if(i==e.startContainer)l=d(i,e.startOffset,i.nodeValue.length);else if(i==e.endContainer)l=d(i,0,e.endOffset);else l=d(i,0,i.nodeValue.length);if(b)try{q.appendChild(l)}catch(u){}}i=r}}o(j,i);g&&a.up().collapse(true);for(var n=0,t=c.length;n<t;n++){var l=c[n];l.parentNode&&l.parentNode.removeChild(l)}return b?i:a}function Q(e,d){var b=d;while(b){var c=a(b);if(c.name=="marquee"||c.name=="select")return;b=b.parentNode}try{e.moveToElementText(d)}catch(f){}}function gc(j,r){var q=j.parentElement().ownerDocument,k=j.duplicate();k.collapse(r);var f=k.parentElement(),o=f.childNodes;if(o.length===0)return{node:f.parentNode,offset:a(f).index()};var b=q,e=0,g=-1,c=j.duplicate();Q(c,f);for(var l=0,s=o.length;l<s;l++){var d=o[l];g=c.compareEndPoints("StartToStart",k);if(g===0)return{node:d.parentNode,offset:l};if(d.nodeType==1){var m=j.duplicate(),i,n=a(d),p=d;if(n.isControl()){i=q.createElement("span");n.after(i);p=i;e+=n.text().replace(/\r\n|\n|\r/g,"").length}Q(m,p);c.setEndPoint("StartToEnd",m);if(g>0)e+=m.text.replace(/\r\n|\n|\r/g,"").length;else e=0;i&&a(i).remove()}else if(d.nodeType==3){c.moveStart("character",d.nodeValue.length);e+=d.nodeValue.length}if(g<0)b=d}if(g<0&&b.nodeType==1)return{node:f,offset:a(f.lastChild).index()+1};if(g>0)while(b.nextSibling&&b.nodeType==1)b=b.nextSibling;c=j.duplicate();Q(c,f);c.setEndPoint("StartToEnd",k);e-=c.text.replace(/\r\n|\n|\r/g,"").length;if(g>0&&b.nodeType==3){var h=b.previousSibling;while(h&&h.nodeType==3){e-=h.nodeValue.length;h=h.previousSibling}}return{node:b,offset:e}}function ec(e,f){var h=e.ownerDocument||e,b=h.body.createTextRange();if(h==e){b.collapse(true);return b}if(e.nodeType==1&&e.childNodes.length>0){var k=e.childNodes,d,c;if(f===0){c=k[0];d=true}else{c=k[f-1];d=false}if(!c)return b;if(a(c).name==="head"){if(f===1)d=true;if(f===2)d=false;b.collapse(d);return b}if(c.nodeType==1){var i=a(c),g;if(i.isControl()){g=h.createElement("span");if(d)i.before(g);else i.after(g);c=g}Q(b,c);b.collapse(d);g&&a(g).remove();return b}e=c;f=d?0:c.nodeValue.length}var j=h.createElement("span");a(e).before(j);Q(b,j);b.moveStart("character",f);a(j).remove();return b}function uc(c){var d,b;function i(b){if(a(b.node).name=="tr"){b.node=b.node.cells[b.offset];b.offset=0}}if(e){if(c.item){d=F(c.item(0));b=new s(d);b.selectNode(c.item(0));return b}d=c.parentElement().ownerDocument;var g=gc(c,true),h=gc(c,false);i(g);i(h);b=new s(d);b.setStart(g.node,g.offset);b.setEnd(h.node,h.offset);return b}var f=c.startContainer;d=f.ownerDocument||f;b=new s(d);b.setStart(f,c.startOffset);b.setEnd(c.endContainer,c.endOffset);return b}function s(a){this.init(a)}p(s,{init:function(b){var a=this;a.startContainer=b;a.startOffset=0;a.endContainer=b;a.endOffset=0;a.collapsed=true;a.doc=b},commonAncestor:function(){function e(a){var b=[];while(a){b.push(a);a=a.parentNode}return b}var b=e(this.startContainer),f=e(this.endContainer),a=0,g=b.length,h=f.length,c,d;while(++a){c=b[g-a];d=f[h-a];if(!c||!d||c!==d)break}return b[g-a+1]},setStart:function(c,b){var a=this,d=a.doc;a.startContainer=c;a.startOffset=b;if(a.endContainer===d){a.endContainer=c;a.endOffset=b}return Rb(this)},setEnd:function(c,b){var a=this,d=a.doc;a.endContainer=c;a.endOffset=b;if(a.startContainer===d){a.startContainer=c;a.startOffset=b}return Rb(this)},setStartBefore:function(b){return this.setStart(b.parentNode||this.doc,a(b).index())},setStartAfter:function(b){return this.setStart(b.parentNode||this.doc,a(b).index()+1)},setEndBefore:function(b){return this.setEnd(b.parentNode||this.doc,a(b).index())},setEndAfter:function(b){return this.setEnd(b.parentNode||this.doc,a(b).index()+1)},selectNode:function(a){return this.setStartBefore(a).setEndAfter(a)},selectNodeContents:function(c){var d=a(c);if(d.type==3||d.isSingle())return this.selectNode(c);var b=d.children();return b.length>0?this.setStartBefore(b[0]).setEndAfter(b[b.length-1]):this.setStart(c,0).setEnd(c,0)},collapse:function(a){return a?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(c,g){var k=this.get(),l=g.get();if(e){var h={};h[R]="StartToStart";h[T]="EndToStart";h[K]="EndToEnd";h[S]="StartToEnd";var n=k.compareEndPoints(h[c],l);if(n!==0)return n;var d,f,b,i,j;if(c===R||c===S){d=this.startContainer;i=this.startOffset}if(c===T||c===K){d=this.endContainer;i=this.endOffset}if(c===R||c===T){f=g.startContainer;j=g.startOffset}if(c===K||c===S){f=g.endContainer;j=g.endOffset}if(d===f){var m=i-j;return m>0?1:m<0?-1:0}b=f;while(b&&b.parentNode!==d)b=b.parentNode;if(b)return a(b).index()>=i?-1:1;b=d;while(b&&b.parentNode!==f)b=b.parentNode;if(b)return a(b).index()>=j?1:-1;b=a(f).next();if(b&&b.contains(d))return 1;b=a(d).next();if(b&&b.contains(f))return-1}else return k.compareBoundaryPoints(c,l)},cloneRange:function(){return(new s(this.doc)).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var a=this.get(),b=e?a.text:a.toString();return b.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return rb(this,true,false)},deleteContents:function(){return rb(this,false,true)},extractContents:function(){return rb(this,true,true)},insertNode:function(b){var c=this,a=c.startContainer,f=c.startOffset,e=c.endContainer,g=c.endOffset,h,j,d,i=1;if(b.nodeName.toLowerCase()==="#document-fragment"){h=b.firstChild;j=b.lastChild;i=b.childNodes.length}if(a.nodeType==1){d=a.childNodes[f];if(d){a.insertBefore(b,d);if(a===e)g+=i}else a.appendChild(b)}else if(a.nodeType==3)if(f===0){a.parentNode.insertBefore(b,a);if(a.parentNode===e)g+=i}else if(f>=a.nodeValue.length)if(a.nextSibling)a.parentNode.insertBefore(b,a.nextSibling);else a.parentNode.appendChild(b);else{if(f>0)d=a.splitText(f);else d=a;a.parentNode.insertBefore(b,d);if(a===e){e=d;g-=f}}if(h)c.setStartBefore(h).setEndAfter(j);else c.selectNode(b);return c.compareBoundaryPoints(K,c.cloneRange().setEnd(e,g))>=1?c:c.setEnd(e,g)},surroundContents:function(a){a.appendChild(this.extractContents());return this.insertNode(a).selectNode(a)},isControl:function(){var b=this,c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g;return c.nodeType==1&&c===e&&d+1===f&&a(c.childNodes[d]).isControl()},"get":function(f){var b=this,d=b.doc,g,a;if(!e){a=d.createRange();try{a.setStart(b.startContainer,b.startOffset);a.setEnd(b.endContainer,b.endOffset)}catch(h){}return a}if(f&&b.isControl()){a=d.body.createControlRange();a.addElement(b.startContainer.childNodes[b.startOffset]);return a}var c=b.cloneRange().down();a=d.body.createTextRange();a.setEndPoint("StartToStart",ec(c.startContainer,c.startOffset));a.setEndPoint("EndToStart",ec(c.endContainer,c.endOffset));return a},html:function(){return a(this.cloneContents()).outer()},down:function(){var b=this;function c(i,h,j){if(i.nodeType!=1)return;var d=a(i).children();if(d.length===0)return;var g,f,c,e;if(h>0)g=d.eq(h-1);if(h<d.length)f=d.eq(h);if(g&&g.type==3){c=g[0];e=c.nodeValue.length}if(f&&f.type==3){c=f[0];e=0}if(!c)return;if(j)b.setStart(c,e);else b.setEnd(c,e)}c(b.startContainer,b.startOffset,true);c(b.endContainer,b.endOffset,false);return b},up:function(){var a=this;function b(b,d,c){if(b.nodeType!=3)return;if(d===0)if(c)a.setStartBefore(b);else a.setEndBefore(b);else if(d==b.nodeValue.length)if(c)a.setStartAfter(b);else a.setEndAfter(b)}b(a.startContainer,a.startOffset,true);b(a.endContainer,a.endOffset,false);return a},enlarge:function(c){var b=this;b.up();function d(h,g,f){var d=a(h),e;if(d.type==3||fb[d.name]||!c&&d.isBlock())return;if(g===0){while(!d.prev()){e=d.parent();if(!e||fb[e.name]||!c&&e.isBlock())break;d=e}if(f)b.setStartBefore(d[0]);else b.setEndBefore(d[0])}else if(g==d.children().length){while(!d.next()){e=d.parent();if(!e||fb[e.name]||!c&&e.isBlock())break;d=e}if(f)b.setStartAfter(d[0]);else b.setEndAfter(d[0])}}d(b.startContainer,b.startOffset,true);d(b.endContainer,b.endOffset,false);return b},shrink:function(){var b=this,c,d=b.collapsed;while(b.startContainer.nodeType==1&&(c=b.startContainer.childNodes[b.startOffset])&&c.nodeType==1&&!a(c).isSingle())b.setStart(c,0);if(d)return b.collapse(d);while(b.endContainer.nodeType==1&&b.endOffset>0&&(c=b.endContainer.childNodes[b.endOffset-1])&&c.nodeType==1&&!a(c).isSingle())b.setEnd(c,c.childNodes.length);return b},createBookmark:function(e){var d=this,f=d.doc,b,c=a('<span style="display:none;"></span>',f)[0];c.id="__kindeditor_bookmark_start_"+bc+++"__";if(!d.collapsed){b=c.cloneNode(true);b.id="__kindeditor_bookmark_end_"+bc+++"__"}b&&d.cloneRange().collapse(false).insertNode(b).setEndBefore(b);d.insertNode(c).setStartAfter(c);return{start:e?"#"+c.id:c,end:b?e?"#"+b.id:b:null}},moveToBookmark:function(e){var b=this,f=b.doc,c=a(e.start,f),d=e.end?a(e.end,f):null;if(!c||c.length<1)return b;b.setStartBefore(c[0]);c.remove();if(d&&d.length>0){b.setEndBefore(d[0]);d.remove()}else b.collapse(true);return b},dump:function(){console.log("--------------------");console.log(this.startContainer.nodeType==3?this.startContainer.nodeValue:this.startContainer,this.startOffset);console.log(this.endContainer.nodeType==3?this.endContainer.nodeValue:this.endContainer,this.endOffset)}});function Jb(a){return!a.nodeName?a.constructor===s?a:uc(a):new s(a)}a.RangeClass=s;a.range=Jb;a.START_TO_START=R;a.START_TO_END=T;a.END_TO_END=K;a.END_TO_START=S;function v(a,b,c){try{a.execCommand(b,false,c)}catch(d){}}function Pb(b,c){var a="";try{a=b.queryCommandValue(c)}catch(d){}if(typeof a!=="string")a="";return a}function Fb(a){var b=G(a);return a.selection||b.getSelection()}function id(c){var b=Fb(c),a;try{if(b.rangeCount>0)a=b.getRangeAt(0);else a=b.createRange()}catch(d){}return e&&(!a||!a.item&&a.parentElement().ownerDocument!==c)?null:a}function ac(e){var c={},a,d;b(e,function(e,g){a=e.split(",");for(var b=0,f=a.length;b<f;b++){d=a[b];c[d]=g}});return c}function vb(a,b){return Qb(a,b,"*")||Qb(a,b)}function Qb(c,k,b){b=b||c.name;if(c.type!==1)return false;var h=ac(k);if(!h[b])return false;for(var i=h[b].split(","),f=0,j=i.length;f<j;f++){var a=i[f];if(a==="*")return true;var d=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(a),g=d[1]?"css":"attr";a=d[2];var e=d[3]||"";if(e===""&&c[g](a)!=="")return true;if(e!==""&&c[g](a)===e)return true}return false}function pb(a,b){if(a.type!=1)return;Nb(a,b,"*");Nb(a,b)}function Nb(b,j,c){c=c||b.name;if(b.type!==1)return;var f=ac(j);if(!f[c])return;for(var h=f[c].split(","),e=false,d=0,i=h.length;d<i;d++){var a=h[d];if(a==="*"){e=true;break}var g=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(a);a=g[2];if(g[1]){a=Y(a);if(b[0].style[a])b[0].style[a]=""}else b.removeAttr(a)}e&&b.remove(true)}function ub(b){var a=b;while(a.first())a=a.first();return a}function J(a){return a.type!=1||a.isSingle()?false:a.html().replace(/<[^>]+>/g,"")===""}function Sc(c,a){c=c.clone(true);var e=ub(c),b=c,d=false;while(a){while(b){if(b.name===a.name){ad(b,a.attr(),a.css());d=true}b=b.first()}!d&&e.append(a.clone(false));d=false;a=a.first()}return c}function fd(c,a){a=a.clone(true);if(c.type==3){ub(a).append(c.clone(false));c.replaceWith(a);return a}var e=c,b;while((b=c.first())&&b.children().length==1)c=b;b=c.first();var d=c.doc.createDocumentFragment();while(b){d.appendChild(b[0]);b=b.next()}a=Sc(e,a);d.firstChild&&ub(a).append(d);e.replaceWith(a);return a}function ad(a,d,c){b(d,function(b,c){b!=="style"&&a.attr(b,c)});b(c,function(b,c){a.css(b,c)})}function Rc(a){while(a&&a.name!="body"){if(wb[a.name]||a.name=="div"&&a.hasClass("ke-script"))return true;a=a.parent()}return false}function eb(a){this.init(a)}p(eb,{init:function(c){var a=this,b=c.doc;a.doc=b;a.win=G(b);a.sel=Fb(b);a.range=c},selection:function(e){var b=this,c=b.doc,d=id(c);b.sel=Fb(c);if(d){b.range=Jb(d);a(b.range.startContainer).name=="html"&&b.range.selectNodeContents(c.body).collapse(false);return b}e&&b.range.selectNodeContents(c.body).collapse(false);return b},select:function(k){k=d(k,true);var f=this,p=f.sel,b=f.range.cloneRange().shrink(),h=b.startContainer,i=b.startOffset,q=b.endContainer,r=b.endOffset,g=F(h),m=f.win,c,n=false;if(k&&h.nodeType==1&&b.collapsed){if(e){var l=a("<span>&nbsp;</span>",g);b.insertNode(l[0]);c=g.body.createTextRange();try{c.moveToElementText(l[0])}catch(s){}c.collapse(false);c.select();l.remove();m.focus();return f}if(H){var j=h.childNodes;if(a(h).isInline()||i>0&&a(j[i-1]).isInline()||j[i]&&a(j[i]).isInline()){b.insertNode(g.createTextNode("\u200b"));n=true}}}if(e)try{c=b.get(true);c.select()}catch(t){}else{n&&b.collapse(false);c=b.get(true);p.removeAllRanges();p.addRange(c);if(g!==document){var o=a(c.endContainer).pos();m.scrollTo(o.x,o.y)}}m.focus();return f},wrap:function(k){var d=this,j=d.doc,b=d.range,c;c=a(k,j);if(b.collapsed){b.shrink();b.insertNode(c[0]).selectNodeContents(c[0]);return d}if(c.isBlock()){var f=c.clone(true),e=f;while(e.first())e=e.first();e.append(b.extractContents());b.insertNode(f[0]).selectNode(f[0]);return d}b.enlarge();var g=b.createBookmark(),i=b.commonAncestor(),h=false;a(i).scan(function(e){if(!h&&e==g.start){h=true;return}if(h){if(e==g.end)return false;var b=a(e);if(Rc(b))return;if(b.type==3&&n(e.nodeValue).length>0){var d;while((d=b.parent())&&d.isStyle()&&d.children().length==1)b=d;fd(b,c)}}});b.moveToBookmark(g);return d},split:function(f,n){var b=this.range,r=b.doc,e=b.cloneRange().collapse(f),g=e.startContainer,o=e.startOffset,c=g.nodeType==3?g.parentNode:g,l=false,h;while(c&&c.parentNode){h=a(c);if(n){if(!h.isStyle())break;if(!vb(h,n))break}else if(fb[h.name])break;l=true;c=c.parentNode}if(l){var d=r.createElement("span");b.cloneRange().collapse(!f).insertNode(d);if(f)e.setStartBefore(c.firstChild).setEnd(g,o);else e.setStart(g,o).setEndAfter(c.lastChild);var i=e.extractContents(),p=i.firstChild,q=i.lastChild;if(f){e.insertNode(i);b.setStartAfter(q).setEndBefore(d)}else{c.appendChild(i);b.setStartBefore(d).setEndBefore(p)}var k=d.parentNode;if(k==b.endContainer){var j=a(d).prev(),m=a(d).next();if(j&&m&&j.type==3&&m.type==3)b.setEnd(j[0],j[0].nodeValue.length);else!f&&b.setEnd(b.endContainer,b.endOffset-1)}k.removeChild(d)}return this},remove:function(h){var f=this,u=f.doc,c=f.range;c.enlarge();if(c.startOffset===0){var g=a(c.startContainer),j;while((j=g.parent())&&j.isStyle()&&j.children().length==1)g=j;c.setStart(g[0],0);g=a(c.startContainer);g.isBlock()&&pb(g,h);var q=g.parent();q&&q.isBlock()&&pb(q,h)}var d,e;if(c.collapsed){f.split(true,h);d=c.startContainer;e=c.startOffset;if(e>0){var s=a(d.childNodes[e-1]);if(s&&J(s)){s.remove();c.setStart(d,e-1)}}var r=a(d.childNodes[e]);r&&J(r)&&r.remove();if(J(d)){c.startBefore(d);d.remove()}c.collapse(true);return f}f.split(true,h);f.split(false,h);var m=u.createElement("span"),p=u.createElement("span");c.cloneRange().collapse(false).insertNode(p);c.cloneRange().collapse(true).insertNode(m);var t=[],n=false;a(c.commonAncestor()).scan(function(a){if(!n&&a==m){n=true;return}if(a==p)return false;n&&t.push(a)});a(m).remove();a(p).remove();d=c.startContainer;e=c.startOffset;var i=c.endContainer,v=c.endOffset;if(e>0){var k=a(d.childNodes[e-1]);if(k&&J(k)){k.remove();c.setStart(d,e-1);d==i&&c.setEnd(i,v-1)}var l=a(d.childNodes[e]);if(l&&J(l)){l.remove();d==i&&c.setEnd(i,v-1)}}var o=a(i.childNodes[c.endOffset]);o&&J(o)&&o.remove();var w=c.createBookmark(true);b(t,function(c,b){pb(a(b),h)});c.moveToBookmark(w);return f},commonNode:function(i){var f=this.range,b=f.endContainer,d=f.endOffset,c=b.nodeType==3||d===0?b:b.childNodes[d-1];function g(d){var c=d,b=d;while(b){if(vb(a(b),i))return a(b);b=b.parentNode}while(c&&(c=c.lastChild))if(vb(a(c),i))return a(c);return null}var e=g(c);if(e)return e;if(c.nodeType==1||b.nodeType==3&&d===0){var h=a(c).prev();if(h)return g(h)}return null},commonAncestor:function(l){var b=this.range,e=b.startContainer,i=b.startOffset,d=b.endContainer,h=b.endOffset,j=e.nodeType==3||i===0?e:e.childNodes[i-1],k=d.nodeType==3||h===0?d:d.childNodes[h-1];function f(a){while(a){if(a.nodeType==1)if(a.tagName.toLowerCase()===l)return a;a=a.parentNode}return null}var c=f(j),g=f(k);return c&&g&&c===g?a(c):null},state:function(d){var b=this,c=b.doc,a=false;try{a=c.queryCommandState(d)}catch(e){}return a},val:function(c){var d=this,f=d.doc,g=d.range;function e(a){return a.toLowerCase()}c=e(c);var a="",b;if(c==="fontfamily"||c==="fontname"){a=Pb(f,"fontname");a=a.replace(/['"]/g,"");return e(a)}if(c==="formatblock"){a=Pb(f,c);if(a===""){b=d.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"});if(b)a=b.name}if(a==="Normal")a="p";return e(a)}if(c==="fontsize"){b=d.commonNode({"*":".font-size"});if(b)a=b.css("font-size");return e(a)}if(c==="forecolor"){b=d.commonNode({"*":".color"});if(b)a=b.css("color");a=nb(a);if(a==="")a="default";return e(a)}if(c==="hilitecolor"){b=d.commonNode({"*":".background-color"});if(b)a=b.css("background-color");a=nb(a);if(a==="")a="default";return e(a)}return a},toggle:function(c,b){var a=this;if(a.commonNode(b))a.remove(b);else a.wrap(c);return a.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(a){return this.toggle('<span style="color:'+a+';"></span>',{span:".color="+a,font:"color"})},hilitecolor:function(a){return this.toggle('<span style="background-color:'+a+';"></span>',{span:".background-color="+a})},fontsize:function(a){return this.toggle('<span style="font-size:'+a+';"></span>',{span:".font-size="+a,font:"size"})},fontname:function(a){return this.fontfamily(a)},fontfamily:function(a){return this.toggle('<span style="font-family:'+a+';"></span>',{span:".font-family="+a,font:"face"})},removeformat:function(){var a={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},c=Yb;b(c,function(b){a[b]="*"});this.remove(a);return this.select()},inserthtml:function(c,h){var b=this,d=b.range;if(c==="")return b;function g(a,d){d='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+d;var c=a.get();if(c.item)c.item(0).outerHTML=d;else c.pasteHTML(d);var f=a.doc.getElementById("__kindeditor_temp_tag__");f.parentNode.removeChild(f);var e=uc(c);a.setEnd(e.endContainer,e.endOffset);a.collapse(false);b.select(false)}function f(c,f){var e=c.doc,d=e.createDocumentFragment();a("@"+f,e).each(function(){d.appendChild(this)});c.deleteContents();c.insertNode(d);c.collapse(false);b.select(false)}if(e&&h){try{g(d,c)}catch(i){f(d,c)}return b}f(d,c);return b},hr:function(){return this.inserthtml("<hr />")},print:function(){this.win.print();return this},insertimage:function(h,b,g,e,c,f){b=d(b,"");c=d(c,0);var a='<img src="'+l(h)+'" data-ke-src="'+l(h)+'" ';if(g)a+='width="'+l(g)+'" ';if(e)a+='height="'+l(e)+'" ';if(b)a+='title="'+l(b)+'" ';if(f)a+='align="'+l(f)+'" ';a+='alt="'+l(b)+'" ';a+="/>";return this.inserthtml(a)},createlink:function(e,g){var b=this,h=b.doc,c=b.range;b.select();var i=b.commonNode({a:"*"});if(i&&!c.isControl()){c.selectNode(i.get());b.select()}var d='<a href="'+l(e)+'" data-ke-src="'+l(e)+'" ';if(g)d+=' target="'+l(g)+'"';if(c.collapsed){d+=">"+l(e)+"</a>";return b.inserthtml(d)}if(c.isControl()){var f=a(c.startContainer.childNodes[c.startOffset]);d+="></a>";f.after(a(d,h));f.next().append(f);c.selectNode(f[0]);return b.select()}v(h,"createlink","__kindeditor_temp_url__");a('a[href="__kindeditor_temp_url__"]',h).each(function(){a(this).attr("href",e).attr("data-ke-src",e);if(g)a(this).attr("target",g);else a(this).removeAttr("target")});return b},unlink:function(){var b=this,e=b.doc,c=b.range;b.select();if(c.collapsed){var f=b.commonNode({a:"*"});if(f){c.selectNode(f.get());b.select()}v(e,"unlink",null);if(H&&a(c.startContainer).name==="img"){var d=a(c.startContainer).parent();d.name==="a"&&d.remove(true)}}else v(e,"unlink",null);return b}});b("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),function(b,a){eb.prototype[a]=function(c){var b=this;b.select();v(b.doc,a,c);(!e||w(a,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0)&&b.selection();return b}});b("cut,copy,paste".split(","),function(b,a){eb.prototype[a]=function(){var b=this;if(!b.doc.queryCommandSupported(a))throw"not supported";b.select();v(b.doc,a,null);return b}});function Fc(a){if(a.nodeName){var b=F(a);a=Jb(b).selectNodeContents(b.body).collapse(false)}return new eb(a)}a.CmdClass=eb;a.cmd=Fc;function Lb(b){var d=b.moveEl,j=b.moveFn,e=b.clickEl||d,h=b.beforeDrag,i=b.iframeFix===c?true:b.iframeFix,g=[document];i&&a("iframe").each(function(){var d=W(this.src||"","absolute");if(/^https?:\/\//.test(d))return;var b;try{b=Ab(this)}catch(e){}if(b){var c=a(this).pos();a(b).data("pos-x",c.x);a(b).data("pos-y",c.y);g.push(b)}});e.mousedown(function(c){c.stopPropagation();var b=e.get(),q=f(d.css("left")),r=f(d.css("top")),p=d.width(),m=d.height(),n=c.pageX,o=c.pageY;h&&h();function k(b){b.preventDefault();var c=a(F(b.target)),d=B((c.data("pos-x")||0)+b.pageX-n),f=B((c.data("pos-y")||0)+b.pageY-o);j.call(e,q,r,p,m,d,f)}function i(a){a.preventDefault()}function l(c){c.preventDefault();a(g).unbind("mousemove",k).unbind("mouseup",l).unbind("selectstart",i);b.releaseCapture&&b.releaseCapture()}a(g).mousemove(k).mouseup(l).bind("selectstart",i);b.setCapture&&b.setCapture()})}function z(a){this.init(a)}p(z,{init:function(d){var b=this;b.name=d.name||"";b.doc=d.doc||document;b.win=G(b.doc);b.x=g(d.x);b.y=g(d.y);b.z=d.z;b.width=g(d.width);b.height=g(d.height);b.div=a('<div style="display:block;"></div>');b.options=d;b._alignEl=d.alignEl;b.width&&b.div.css("width",b.width);b.height&&b.div.css("height",b.height);b.z&&b.div.css({position:"absolute",left:b.x,top:b.y,"z-index":b.z});b.z&&(b.x===c||b.y===c)&&b.autoPos(b.width,b.height);d.cls&&b.div.addClass(d.cls);d.shadowMode&&b.div.addClass("ke-shadow");d.css&&b.div.css(d.css);if(d.src)a(d.src).replaceWith(b.div);else a(b.doc.body).append(b.div);d.html&&b.div.html(d.html);if(d.autoScroll)if(e&&j<7||A){var h=I();a(b.win).bind("scroll",function(){var a=I(),c=a.x-h.x,d=a.y-h.y;b.pos(f(b.x)+c,f(b.y)+d,false)})}else b.div.css("position","fixed")},pos:function(a,b,e){var c=this;e=d(e,true);if(a!==null){a=a<0?0:g(a);c.div.css("left",a);if(e)c.x=a}if(b!==null){b=b<0?0:g(b);c.div.css("top",b);if(e)c.y=b}return c},autoPos:function(p,n){var c=this,m=f(p)||0,l=f(n)||0,b=I();if(c._alignEl){var g=a(c._alignEl),d=g.pos(),h=B(g[0].clientWidth/2-m/2),i=B(g[0].clientHeight/2-l/2);x=h<0?d.x:d.x+h;y=i<0?d.y:d.y+i}else{var k=o(c.doc);x=B(b.x+(k.clientWidth-m)/2);y=B(b.y+(k.clientHeight-l)/2)}if(!(e&&j<7||A)){x-=b.x;y-=b.y}return c.pos(x,y)},remove:function(){var c=this;(e&&j<7||A)&&a(c.win).unbind("scroll");c.div.remove();b(c,function(a){c[a]=null});return this},show:function(){this.div.show();return this},hide:function(){this.div.hide();return this},draggable:function(a){var b=this;a=a||{};a.moveEl=b.div;a.moveFn=function(a,c,g,f,d,e){if((a=a+d)<0)a=0;if((c=c+e)<0)c=0;b.pos(a,c)};Lb(a);return b}});function Gb(a){return new z(a)}a.WidgetClass=z;a.widget=Gb;function Ab(a){a=t(a);return a.contentDocument||a.contentWindow.document}var Ec,zb="";if(Ec=document.getElementsByTagName("html"))zb=Ec[0].dir;function Xc(a,e,c,f){var d=[zb===""?"<html>":'<html dir="'+zb+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","\tborder:1px solid #AAA;","\tbackground-image:url("+a+"common/flash.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-flv {","   border:1px solid #AAA;","   background-image:url("+a+"common/flv.gif);","   background-position:center center;","   background-repeat:no-repeat;","   width:100px;","   height:100px;","}","img.ke-rm {","\tborder:1px solid #AAA;","\tbackground-image:url("+a+"common/rm.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-media {","\tborder:1px solid #AAA;","\tbackground-image:url("+a+"common/media.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-anchor {","\tborder:1px dashed #666;","\twidth:16px;","\theight:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","\tdisplay:none;","\tfont-size:0;","\twidth:0;","\theight:0;","}",".ke-pagebreak {","\tborder:1px dotted #AAA;","\tfont-size:0;","\theight:2px;","}","</style>"];if(!M(c))c=[c];b(c,function(b,a){a&&d.push('<link href="'+a+'" rel="stylesheet" />')});f&&d.push("<style>"+f+"</style>");d.push("</head><body "+(e?'class="'+e+'"':"")+"></body></html>");return d.join("\n")}function V(a,d){if(a.hasVal()){if(d===c){var b=a.val();b=b.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/ig,"");return b}return a.val(d)}return a.html(d)}function cb(a){this.init(a)}p(cb,z,{init:function(c){var b=this;cb.parent.init.call(b,c);b.srcElement=a(c.srcElement);b.div.addClass("ke-edit");b.designMode=d(c.designMode,true);b.beforeGetHtml=c.beforeGetHtml;b.beforeSetHtml=c.beforeSetHtml;b.afterSetHtml=c.afterSetHtml;var h=d(c.themesPath,""),i=c.bodyClass,m=c.cssPath,l=c.cssData,f=location.host.replace(/:\d+/,"")!==document.domain,k="document.open();"+(f?'document.domain="'+document.domain+'";':"")+"document.close();",j=e?' src="javascript:void(function(){'+encodeURIComponent(k)+'}())"':"";b.iframe=a('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+j+"></iframe>").css("width","100%");b.textarea=a('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%");b.width&&b.setWidth(b.width);b.height&&b.setHeight(b.height);if(b.designMode)b.textarea.hide();else b.iframe.hide();function g(){var d=Ab(b.iframe);d.open();if(f)d.domain=document.domain;d.write(Xc(h,i,m,l));d.close();b.win=b.iframe[0].contentWindow;b.doc=d;var g=Fc(d);b.afterChange(function(){g.selection()});H&&a(d).click(function(b){if(a(b.target).name==="img"){g.selection(true);g.range.selectNode(b.target);g.select()}});if(e){b._mousedownHandler=function(){var a=g.range.cloneRange();a.shrink();a.isControl()&&b.blur()};a(document).mousedown(b._mousedownHandler);a(d).keydown(function(c){if(c.which==8){g.selection();var b=g.range;if(b.isControl()){b.collapse(true);a(b.startContainer.childNodes[b.startOffset]).remove();c.preventDefault()}}})}b.cmd=g;b.html(V(b.srcElement));if(e){d.body.disabled=true;d.body.contentEditable=true;d.body.removeAttribute("disabled")}else d.designMode="on";c.afterCreate&&c.afterCreate.call(b)}f&&b.iframe.bind("load",function(){b.iframe.unbind("load");if(e)g();else setTimeout(g,0)});b.div.append(b.iframe);b.div.append(b.textarea);b.srcElement.hide();!f&&g()},setWidth:function(a){this.div.css("width",g(a));return this},setHeight:function(a){var b=this;a=g(a);b.div.css("height",a);b.iframe.css("height",a);if(e&&j<8||A)a=g(f(a)-2);b.textarea.css("height",a);return b},remove:function(){var b=this,c=b.doc;a(c.body).unbind();a(c).unbind();a(b.win).unbind();b._mousedownHandler&&a(document).unbind("mousedown",b._mousedownHandler);V(b.srcElement,b.html());b.srcElement.show();c.write("");b.iframe.unbind();b.textarea.unbind();cb.parent.remove.call(b)},html:function(b,g){var d=this,h=d.doc;if(d.designMode){var f=h.body;if(b===c){if(g)b="<!doctype html><html>"+f.parentNode.innerHTML+"</html>";else b=f.innerHTML;if(d.beforeGetHtml)b=d.beforeGetHtml(b);if(N&&b=="<br />")b="";return b}if(d.beforeSetHtml)b=d.beforeSetHtml(b);if(e&&j>=9)b=b.replace(/(<.*?checked=")checked(".*>)/ig,"$1$2");a(f).html(b);d.afterSetHtml&&d.afterSetHtml();return d}if(b===c)return d.textarea.val();d.textarea.val(b);return d},design:function(d){var a=this,b;if(d===c?!a.designMode:d){if(!a.designMode){b=a.html();a.designMode=true;a.html(b);a.textarea.hide();a.iframe.show()}}else if(a.designMode){b=a.html();a.designMode=false;a.html(b);a.iframe.hide();a.textarea.show()}return a.focus()},focus:function(){var a=this;a.designMode?a.win.focus():a.textarea[0].focus();return a},blur:function(){var b=this;if(e){var c=a('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',b.div);b.div.append(c);c[0].focus();c.remove()}else b.designMode?b.win.blur():b.textarea[0].blur();return b},afterChange:function(b){var c=this,d=c.doc,f=d.body;a(d).keyup(function(a){!a.ctrlKey&&!a.altKey&&qb[a.which]&&b(a)});a(d).mouseup(b).contextmenu(b);a(c.win).blur(b);function e(a){setTimeout(function(){b(a)},1)}a(f).bind("paste",e);a(f).bind("cut",e);return c}});function Ac(a){return new cb(a)}a.EditClass=cb;a.edit=Ac;a.iframeDoc=Ab;function Xb(b,d){var c=this,a=c.get(b);if(a){if(a.hasClass("ke-disabled"))return;d(a)}}function kb(a){this.init(a)}p(kb,z,{init:function(c){var b=this;kb.parent.init.call(b,c);b.disableMode=d(c.disableMode,false);b.noDisableItemMap=i(d(c.noDisableItems,[]));b._itemMap={};b.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(a){a.preventDefault()}).attr("unselectable","on");function f(c){var b=a(c);return b.hasClass("ke-outline")?b:b.hasClass("ke-toolbar-icon")?b.parent():void 0}function e(c,b){var a=f(c.target);if(a){if(a.hasClass("ke-disabled"))return;if(a.hasClass("ke-selected"))return;a[b]("ke-on")}}b.div.mouseover(function(a){e(a,"addClass")}).mouseout(function(a){e(a,"removeClass")}).click(function(c){var a=f(c.target);if(a){if(a.hasClass("ke-disabled"))return;b.options.click.call(this,c,a.attr("data-name"))}})},"get":function(b){return this._itemMap[b]?this._itemMap[b]:(this._itemMap[b]=a("span.ke-icon-"+b,this.div).parent())},select:function(a){Xb.call(this,a,function(a){a.addClass("ke-selected")});return self},unselect:function(a){Xb.call(this,a,function(a){a.removeClass("ke-selected").removeClass("ke-on")});return self},enable:function(b){var c=this,a=b.get?b:c.get(b);if(a){a.removeClass("ke-disabled");a.opacity(1)}return c},disable:function(b){var c=this,a=b.get?b:c.get(b);if(a){a.removeClass("ke-selected").addClass("ke-disabled");a.opacity(.5)}return c},disableAll:function(f,e){var b=this,d=b.noDisableItemMap,g;if(e)d=i(e);if(f===c?!b.disableMode:f){a("span.ke-outline",b.div).each(function(){var c=a(this),e=c[0].getAttribute("data-name",2);!d[e]&&b.disable(c)});b.disableMode=true}else{a("span.ke-outline",b.div).each(function(){var c=a(this),e=c[0].getAttribute("data-name",2);!d[e]&&b.enable(c)});b.disableMode=false}return b}});function tc(a){return new kb(a)}a.ToolbarClass=kb;a.toolbar=tc;function db(a){this.init(a)}p(db,z,{init:function(a){var b=this;a.z=a.z||811213;db.parent.init.call(b,a);b.centerLineMode=d(a.centerLineMode,true);b.div.addClass("ke-menu").bind("click,mousedown",function(a){a.stopPropagation()}).attr("unselectable","on")},addItem:function(c){var h=this;if(c.title==="-"){h.div.append(a('<div class="ke-menu-separator"></div>'));return}var e=a('<div class="ke-menu-item" unselectable="on"></div>'),k=a('<div class="ke-inline-block ke-menu-item-left"></div>'),j=a('<div class="ke-inline-block ke-menu-item-right"></div>'),f=g(c.height),i=d(c.iconClass,"");h.div.append(e);if(f){e.css("height",f);j.css("line-height",f)}var b;if(h.centerLineMode){b=a('<div class="ke-inline-block ke-menu-item-center"></div>');f&&b.css("height",f)}e.mouseover(function(){a(this).addClass("ke-menu-item-on");b&&b.addClass("ke-menu-item-center-on")}).mouseout(function(){a(this).removeClass("ke-menu-item-on");b&&b.removeClass("ke-menu-item-center-on")}).click(function(b){c.click.call(a(this));b.stopPropagation()}).append(k);b&&e.append(b);e.append(j);if(c.checked)i="ke-icon-checked";i!==""&&k.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+i+'"></span>');j.html(c.title);return h},remove:function(){var b=this;b.options.beforeRemove&&b.options.beforeRemove.call(b);a(".ke-menu-item",b.div[0]).unbind();db.parent.remove.call(b);return b}});function Mb(a){return new db(a)}a.MenuClass=db;a.menu=Mb;function U(a){this.init(a)}p(U,z,{init:function(c){var a=this;c.z=c.z||811213;U.parent.init.call(a,c);var e=c.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];a.selectedColor=(c.selectedColor||"").toLowerCase();a._cells=[];a.div.addClass("ke-colorpicker").bind("click,mousedown",function(a){a.stopPropagation()}).attr("unselectable","on");var b=a.doc.createElement("table");a.div.append(b);b.className="ke-colorpicker-table";b.cellPadding=0;b.cellSpacing=0;b.border=0;var h=b.insertRow(0),f=h.insertCell(0);f.colSpan=e[0].length;a._addAttr(f,"","ke-colorpicker-cell-top");for(var d=0;d<e.length;d++){h=b.insertRow(d+1);for(var g=0;g<e[d].length;g++){f=h.insertCell(g);a._addAttr(f,e[d][g],"ke-colorpicker-cell")}}},_addAttr:function(b,c,e){var d=this;b=a(b).addClass(e);d.selectedColor===c.toLowerCase()&&b.addClass("ke-colorpicker-cell-selected");b.attr("title",c||d.options.noColor);b.mouseover(function(){a(this).addClass("ke-colorpicker-cell-on")});b.mouseout(function(){a(this).removeClass("ke-colorpicker-cell-on")});b.click(function(b){b.stop();d.options.click.call(a(this),c)});if(c)b.append(a('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",c));else b.html(d.options.noColor);a(b).attr("unselectable","on");d._cells.push(b)},remove:function(){var a=this;b(a._cells,function(){this.unbind()});U.parent.remove.call(a);return a}});function dc(a){return new U(a)}a.ColorPickerClass=U;a.colorpicker=dc;function tb(a){this.init(a)}p(tb,{init:function(b){var d=this,c=a(b.button),j=b.fieldName||"file",o=b.url||"",k=c.val(),h=b.extraParams||{},n=c[0].className||"",f=b.target||"kindeditor_upload_iframe_"+(new Date).getTime();b.afterError=b.afterError||function(a){alert(a)};var g=[];for(var i in h)g.push('<input type="hidden" name="'+i+'" value="'+h[i]+'" />');var m=['<div class="ke-inline-block '+n+'">',b.target?"":'<iframe name="'+f+'" style="display:none;"></iframe>',b.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+f+'" action="'+o+'">','<span class="ke-button-common">',g.join(""),'<input type="button" class="ke-button-common ke-button" value="'+k+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+j+'" tabindex="-1" />',b.form?"</div>":"</form>","</div>"].join(""),e=a(m,c.doc);c.hide();c.before(e);d.div=e;d.button=c;d.iframe=b.target?a('iframe[name="'+f+'"]'):a("iframe",e);d.form=b.form?a(b.form):a("form",e);var l=b.width||a(".ke-button-common",e).width();d.fileBox=a(".ke-upload-file",e).width(l);d.options=b},submit:function(){var b=this,c=b.iframe;c.bind("load",function(){c.unbind();var e=document.createElement("form");b.fileBox.before(e);a(e).append(b.fileBox);e.reset();a(e).remove(true);var g=a.iframeDoc(c),h=g.getElementsByTagName("pre")[0],d="",f;if(h)d=h.innerHTML;else d=g.body.innerHTML;d=X(d);c[0].src="javascript:false";try{f=a.json(d)}catch(i){b.options.afterError.call(b,"<!doctype html><html>"+g.body.parentNode.innerHTML+"</html>")}f&&b.options.afterUpload.call(b,f)});b.form[0].submit();return b},remove:function(){var a=this;a.fileBox&&a.fileBox.unbind();a.iframe.remove();a.div.remove();a.button.show();return a}});function Tc(a){return new tb(a)}a.UploadButtonClass=tb;a.uploadbutton=Tc;function Qc(b){b=b||{};var c=b.name||"",d=a('<span class="ke-button-common ke-button-outer" title="'+c+'"></span>'),e=a('<input class="ke-button-common ke-button" type="button" value="'+c+'" />');b.click&&e.click(b.click);d.append(e);return d}function Z(a){this.init(a)}p(Z,z,{init:function(g){var c=this,s=d(g.shadowMode,true);g.z=g.z||811213;g.shadowMode=false;g.autoScroll=d(g.autoScroll,true);Z.parent.init.call(c,g);var w=g.title,x=a(g.body,c.doc),n=g.previewBtn,q=g.yesBtn,r=g.noBtn,p=g.closeBtn,v=d(g.showMask,true);c.div.addClass("ke-dialog").bind("click,mousedown",function(a){a.stopPropagation()});var m=a('<div class="ke-dialog-content"></div>').appendTo(c.div);if(e&&j<7)c.iframeMask=a('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(c.div);else s&&a('<div class="ke-dialog-shadow"></div>').appendTo(c.div);var h=a('<div class="ke-dialog-header"></div>');m.append(h);h.html(w);c.closeIcon=a('<span class="ke-dialog-icon-close" title="'+p.name+'"></span>').click(p.click);h.append(c.closeIcon);c.draggable({clickEl:h,beforeDrag:g.beforeDrag});var k=a('<div class="ke-dialog-body"></div>');m.append(k);k.append(x);var i=a('<div class="ke-dialog-footer"></div>');(n||q||r)&&m.append(i);b([{btn:n,name:"preview"},{btn:q,name:"yes"},{btn:r,name:"no"}],function(){if(this.btn){var a=Qc(this.btn);a.addClass("ke-dialog-"+this.name);i.append(a)}});c.height&&k.height(f(c.height)-h.height()-i.height());c.div.width(c.div.width());c.div.height(c.div.height());c.mask=null;if(v){var l=o(c.doc),u=Math.max(l.scrollWidth,l.clientWidth),t=Math.max(l.scrollHeight,l.clientHeight);c.mask=Gb({x:0,y:0,z:c.z-1,cls:"ke-dialog-mask",width:u,height:t})}c.autoPos(c.div.width(),c.div.height());c.footerDiv=i;c.bodyDiv=k;c.headerDiv=h;c.isLoading=false},setMaskIndex:function(b){var a=this;a.mask.div.css("z-index",b)},showLoading:function(e){e=d(e,"");var b=this,c=b.bodyDiv;b.loading=a('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(c.height()/3)+'px;">'+e+"</div></div>").width(c.width()).height(c.height()).css("top",b.headerDiv.height()+"px");c.css("visibility","hidden").after(b.loading);b.isLoading=true;return b},hideLoading:function(){this.loading&&this.loading.remove();this.bodyDiv.css("visibility","visible");this.isLoading=false;return this},remove:function(){var b=this;b.options.beforeRemove&&b.options.beforeRemove.call(b);b.mask&&b.mask.remove();b.iframeMask&&b.iframeMask.remove();b.closeIcon.unbind();a("input",b.div).unbind();a("button",b.div).unbind();b.footerDiv.unbind();b.bodyDiv.unbind();b.headerDiv.unbind();a("iframe",b.div).each(function(){a(this).remove()});Z.parent.remove.call(b);return b}});function wc(a){return new Z(a)}a.DialogClass=Z;a.dialog=wc;function od(g){var c=Gb(g),i=c.remove,f=g.afterSelect,h=c.div,d=[];h.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(a){a.preventDefault()});var e=a('<ul class="ke-tabs-ul ke-clearfix"></ul>');h.append(e);c.add=function(c){var b=a('<li class="ke-tabs-li">'+c.title+"</li>");b.data("tab",c);d.push(b);e.append(b)};c.selectedIndex=0;c.select=function(e){c.selectedIndex=e;b(d,function(d,b){b.unbind();if(d===e){b.addClass("ke-tabs-li-selected");a(b.data("tab").panel).show("")}else{b.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){a(this).addClass("ke-tabs-li-on")}).mouseout(function(){a(this).removeClass("ke-tabs-li-on")}).click(function(){c.select(d)});a(b.data("tab").panel).hide()}});f&&f.call(c,e)};c.remove=function(){b(d,function(){this.remove()});e.remove();i.call(c)};return c}a.tabs=od;function xb(d,c){var b=document.getElementsByTagName("head")[0]||(A?document.body:document.documentElement),a=document.createElement("script");b.appendChild(a);a.src=d;a.charset="utf-8";a.onload=a.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"){c&&c();a.onload=a.onreadystatechange=null;b.removeChild(a)}}}function mc(a){var b=a.indexOf("?");return b>0?a.substr(0,b):a}function Bb(f){for(var e=document.getElementsByTagName("head")[0]||(A?document.body:document.documentElement),b=document.createElement("link"),g=mc(W(f,"absolute")),d=a('link[rel="stylesheet"]',e),c=0,h=d.length;c<h;c++)if(mc(W(d[c].href,"absolute"))===g)return;e.appendChild(b);b.href=f;b.rel="stylesheet"}function nd(h,f,c,g,d){c=c||"GET";d=d||"json";var a=k.XMLHttpRequest?new k.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open(c,h,true);a.onreadystatechange=function(){if(a.readyState==4&&a.status==200)if(f){var b=n(a.responseText);if(d=="json")b=Cc(b);f(b)}};if(c=="POST"){var e=[];b(g,function(a,b){e.push(encodeURIComponent(a)+"="+encodeURIComponent(b))});try{a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(i){}a.send(e.join("&"))}else a.send(null)}a.loadScript=xb;a.loadStyle=Bb;a.ajax=nd;var E={};function yc(a,b){if(a===c)return E;if(!b)return E[a];E[a]=b}var r={};function Zb(b){var a,c="core";if(a=/^(\w+)\.(\w+)$/.exec(b)){c=a[1];b=a[2]}return{ns:c,key:b}}function Dc(e,d){d=d===c?a.options.langType:d;if(typeof e==="string"){if(!r[d])return"no language";var g=e.length-1;if(e.substr(g)===".")return r[d][e.substr(0,g)];var f=Zb(e);return r[d][f.ns][f.key]}b(e,function(b,c){var a=Zb(b);if(!r[d])r[d]={};if(!r[d][a.ns])r[d][a.ns]={};r[d][a.ns][a.key]=c})}function P(b,d){if(b.collapsed)return;b=b.cloneRange().up();var e=b.startContainer,f=b.startOffset;if(!H&&!b.isControl())return;var c=a(e.childNodes[f]);return!c||c.name!="img"?void 0:d(c)?c:void 0}function Gc(){var c=this,d=c.edit.doc;a(d).contextmenu(function(g){c.menu&&c.hideMenu();if(!c.useContextmenu){g.preventDefault();return}if(c._contextmenus.length===0)return;var h=0,d=[];b(c._contextmenus,function(){if(this.title=="-"){d.push(this);return}if(this.cond&&this.cond()){d.push(this);if(this.width&&this.width>h)h=this.width}});while(d.length>0&&d[0].title=="-")d.shift();while(d.length>0&&d[d.length-1].title=="-")d.pop();var j=null;b(d,function(a){if(this.title=="-"&&j.title=="-")delete d[a];j=this});if(d.length>0){g.preventDefault();var k=a(c.edit.iframe).pos(),e=Mb({x:k.x+g.clientX,y:k.y+g.clientY,width:h,css:{visibility:"hidden"},shadowMode:c.shadowMode});b(d,function(){this.title&&e.addItem(this)});var l=o(e.doc),i=e.div.height();g.clientY+i>=l.clientHeight-100&&e.pos(e.x,f(e.y)-i);e.div.css("visibility","visible");c.menu=e}})}function Jc(){var b=this,d=b.edit.doc,c=b.newlineTag;if(e&&c!=="br")return;if(N&&j<3&&c!=="p")return;if(Ib&&j<9)return;var h=i("h1,h2,h3,h4,h5,h6,pre,li"),g=i("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");function f(c){var b=a(c.commonAncestor());while(b){if(b.type==1&&!b.isStyle())break;b=b.parent()}return b.name}a(d).keydown(function(a){if(a.which!=13||a.shiftKey||a.ctrlKey||a.altKey)return;b.cmd.selection();var i=f(b.cmd.range);if(i=="marquee"||i=="select")return;if(c==="br"&&!h[i]){a.preventDefault();b.insertHtml("<br />"+(e&&j<9?"":"\u200b"));return}!g[i]&&v(d,"formatblock","<p>")});a(d).keyup(function(i){if(i.which!=13||i.shiftKey||i.ctrlKey||i.altKey)return;if(c=="br")return;if(N){var n=b.cmd.commonAncestor("p"),k=b.cmd.commonAncestor("a");if(k&&k.text()==""){k.remove(true);b.cmd.range.selectNodeContents(n[0]).collapse(true);b.cmd.select()}return}b.cmd.selection();var j=f(b.cmd.range);if(j=="marquee"||j=="select")return;!g[j]&&v(d,"formatblock","<p>");var h=b.cmd.commonAncestor("div");if(h){var l=a("<p></p>"),e=h[0].firstChild;while(e){var m=e.nextSibling;l.append(e);e=m}h.before(l);h.remove();b.cmd.range.selectNodeContents(l[0]);b.cmd.select()}})}function Pc(){var b=this,c=b.edit.doc;a(c).keydown(function(e){if(e.which==9){e.preventDefault();if(b.afterTab){b.afterTab.call(b,e);return}var f=b.cmd,d=f.range;d.shrink();if(d.collapsed&&d.startContainer.nodeType==1){d.insertNode(a("@&nbsp;",c)[0]);f.select()}b.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function Lc(){var b=this;a(b.edit.textarea[0],b.edit.win).focus(function(a){b.afterFocus&&b.afterFocus.call(b,a)}).blur(function(a){b.afterBlur&&b.afterBlur.call(b,a)})}function C(a){return n(a.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/ig,""))}function sb(a){return a.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/ig,"")}function Ob(a,b){if(a.length===0){a.push(b);return}var c=a[a.length-1];C(b.html)!==C(c.html)&&a.push(b)}function kc(e,i){var d=this,f=d.edit,h=f.doc.body,g,c;if(e.length===0)return d;if(f.designMode){g=d.cmd.range;c=g.createBookmark(true);c.html=h.innerHTML}else c={html:h.innerHTML};Ob(i,c);var b=e.pop();if(C(c.html)===C(b.html)&&e.length>0)b=e.pop();if(f.designMode){f.html(b.html);if(b.start){g.moveToBookmark(b);d.select()}}else a(h).html(C(b.html));return d}function ab(i){var e=this;e.options={};function f(a,b){if(ab.prototype[a]===c)e[a]=b;e.options[a]=b}b(i,function(a){f(a,i[a])});b(a.options,function(a,b){e[a]===c&&f(a,b)});var h=a(e.srcElement||"<textarea/>");if(!e.width)e.width=h[0].style.width||h.width();if(!e.height)e.height=h[0].style.height||h.height();f("width",d(e.width,e.minWidth));f("height",d(e.height,e.minHeight));f("width",g(e.width));f("height",g(e.height));if(jd&&(!qd||j<534))e.designMode=false;e.srcElement=h;e.initContent="";e.plugin={};e.isCreated=false;e.isLoading=false;e._handlers={};e._contextmenus=[];e._undoStack=[];e._redoStack=[];e._calledPlugins={};e._firstAddBookmark=true;e.menu=e.contextmenu=null;e.dialogs=[]}ab.prototype={lang:function(a){return Dc(a,this.langType)},loadPlugin:function(c,d){var b=this;if(E[c]){if(b._calledPlugins[c]){d&&d.call(b);return b}E[c].call(b,KindEditor);d&&d.call(b);b._calledPlugins[c]=true;return b}if(b.isLoading)return b;b.isLoading=true;xb(b.pluginsPath+c+"/"+c+".js?ver="+encodeURIComponent(a.DEBUG?ob:mb),function(){b.isLoading=false;E[c]&&b.loadPlugin(c,d)});return b},handler:function(d,c){var a=this;if(!a._handlers[d])a._handlers[d]=[];if(ic(c)){a._handlers[d].push(c);return a}b(a._handlers[d],function(){c=this.call(a,c)});return c},clickToolbar:function(d,e){var a=this,b="clickToolbar"+d;if(e===c){if(a._handlers[b])return a.handler(b);a.loadPlugin(d,function(){a.handler(b)});return a}return a.handler(b,e)},updateState:function(){var a=this;b("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,subscript,superscript,bold,italic,underline,strikethrough".split(","),function(c,b){a.cmd.state(b)?a.toolbar.select(b):a.toolbar.unselect(b)});return a},addContextmenu:function(a){this._contextmenus.push(a);return this},afterCreate:function(a){return this.handler("afterCreate",a)},beforeRemove:function(a){return this.handler("beforeRemove",a)},beforeGetHtml:function(a){return this.handler("beforeGetHtml",a)},beforeSetHtml:function(a){return this.handler("beforeSetHtml",a)},afterSetHtml:function(a){return this.handler("afterSetHtml",a)},create:function(){var b=this,i=b.fullscreenMode;if(b.isCreated)return b;if(b.srcElement.data("kindeditor"))return b;b.srcElement.data("kindeditor","true");if(i)o().style.overflow="hidden";else o().style.overflow="";var r=i?o().clientWidth+"px":b.width,m=i?o().clientHeight+"px":b.height;if(e&&j<8||A)m=g(f(m)+2);var c=b.container=a(b.layout);if(i)a(document.body).append(c);else b.srcElement.before(c);var s=a(".toolbar",c),t=a(".edit",c),d=b.statusbar=a(".statusbar",c);c.removeClass("container").addClass("ke-container ke-container-"+b.themeType).css("width",r);if(i){c.css({position:"absolute",left:0,top:0,"z-index":811211});if(!N)b._scrollPos=I();k.scrollTo(0,0);a(document.body).css({height:"1px",overflow:"hidden"});a(document.body.parentNode).css("overflow","hidden");b._fullscreenExecuted=true}else{if(b._fullscreenExecuted){a(document.body).css({height:"",overflow:""});a(document.body.parentNode).css("overflow","")}b._scrollPos&&k.scrollTo(b._scrollPos.x,b._scrollPos.y)}var l=[];a.each(b.items,function(c,a){if(a=="|")l.push('<span class="ke-inline-block ke-separator"></span>');else if(a=="/")l.push('<div class="ke-hr"></div>');else{l.push('<span class="ke-outline" data-name="'+a+'" title="'+b.lang(a)+'" unselectable="on">');l.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+a+'" unselectable="on"></span></span>')}});var q=b.toolbar=tc({src:s,html:l.join(""),noDisableItems:b.noDisableItems,click:function(d,a){d.stop();if(b.menu){var c=b.menu.name;b.hideMenu();if(c===a)return}b.clickToolbar(a)}}),n=f(m)-q.div.height(),h=b.edit=Ac({height:n>0&&f(m)>b.minHeight?n:b.minHeight,src:t,srcElement:b.srcElement,designMode:b.designMode,themesPath:b.themesPath,bodyClass:b.bodyClass,cssPath:b.cssPath,cssData:b.cssData,beforeGetHtml:function(a){a=b.beforeGetHtml(a);return D(a,b.filterMode?b.htmlTags:null,b.urlType,b.wellFormatMode,b.indentChar)},beforeSetHtml:function(a){a=D(a,b.filterMode?b.htmlTags:null,"",false);return b.beforeSetHtml(a)},afterSetHtml:function(){b.edit=h=this;b.afterSetHtml()},afterCreate:function(){b.edit=h=this;b.cmd=h.cmd;b._docMousedownFn=function(){b.menu&&b.hideMenu()};a(h.doc,document).mousedown(b._docMousedownFn);Gc.call(b);Jc.call(b);Pc.call(b);Lc.call(b);h.afterChange(function(){if(!h.designMode)return;b.updateState();b.addBookmark();b.options.afterChange&&b.options.afterChange.call(b)});h.textarea.keyup(function(a){if(!a.ctrlKey&&!a.altKey&&Wb[a.which])b.options.afterChange&&b.options.afterChange.call(b)});b.readonlyMode&&b.readonly();b.isCreated=true;if(b.initContent==="")b.initContent=b.html();b.afterCreate();b.options.afterCreate&&b.options.afterCreate.call(b)}});d.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>');if(b._fullscreenResizeHandler){a(k).unbind("resize",b._fullscreenResizeHandler);b._fullscreenResizeHandler=null}function p(){if(d.height()===0){setTimeout(p,100);return}b.resize(r,m,false)}p();if(i){b._fullscreenResizeHandler=function(){b.isCreated&&b.resize(o().clientWidth,o().clientHeight,false)};a(k).bind("resize",b._fullscreenResizeHandler);q.select("fullscreen");d.first().css("visibility","hidden");d.last().css("visibility","hidden")}else{N&&a(k).bind("scroll",function(){b._scrollPos=I()});if(b.resizeType>0)Lb({moveEl:c,clickEl:d,moveFn:function(f,g,e,a,d,c){a+=c;b.resize(null,a)}});else d.first().css("visibility","hidden");if(b.resizeType===2)Lb({moveEl:c,clickEl:d.last(),moveFn:function(f,g,c,a,d,e){c+=d;a+=e;b.resize(c,a)}});else d.last().css("visibility","hidden")}return b},remove:function(){var c=this;if(!c.isCreated)return c;c.beforeRemove();c.srcElement.data("kindeditor","");c.menu&&c.hideMenu();b(c.dialogs,function(){c.hideDialog()});a(document).unbind("mousedown",c._docMousedownFn);c.toolbar.remove();c.edit.remove();c.statusbar.last().unbind();c.statusbar.unbind();c.container.remove();c.container=c.toolbar=c.edit=c.menu=null;c.dialogs=[];c.isCreated=false;return c},resize:function(b,c,e){var a=this;e=d(e,true);if(b){if(!/%/.test(b)){b=f(b);b=b<a.minWidth?a.minWidth:b}a.container.css("width",g(b));if(e)a.width=g(b)}if(c){c=f(c);editHeight=f(c)-a.toolbar.div.height()-a.statusbar.height();editHeight=editHeight<a.minHeight?a.minHeight:editHeight;a.edit.setHeight(editHeight);if(e)a.height=g(c)}return a},select:function(){this.isCreated&&this.cmd.select();return this},html:function(b){var a=this;if(b===c)return a.isCreated?a.edit.html():V(a.srcElement);a.isCreated?a.edit.html(b):V(a.srcElement,b);a.isCreated&&a.cmd.selection();return a},fullHtml:function(){return this.isCreated?this.edit.html(c,true):""},text:function(b){var a=this;return b===c?n(a.html().replace(/<(?!img|embed).*?>/ig,"").replace(/&nbsp;/ig," ")):a.html(l(b))},isEmpty:function(){return n(this.text().replace(/\r\n|\n|\r/,""))===""},isDirty:function(){return n(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==n(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){return this.isCreated?this.cmd.range.html():""},count:function(a){var b=this;a=(a||"html").toLowerCase();return a==="html"?C(sb(b.html())).length:a==="text"?b.text().replace(/<(?:img|embed).*?>/ig,"K").replace(/\r\n|\n|\r/g,"").length:0},exec:function(b){b=b.toLowerCase();var a=this,d=a.cmd,c=w(b,"selectall,copy,paste,print".split(","))<0;c&&a.addBookmark(false);d[b].apply(d,Eb(arguments,1));if(c){a.updateState();a.addBookmark(false);a.options.afterChange&&a.options.afterChange.call(a)}return a},insertHtml:function(a,b){if(!this.isCreated)return this;a=this.beforeSetHtml(a);this.exec("inserthtml",a,b);return this},appendHtml:function(b){this.html(this.html()+b);if(this.isCreated){var a=this.cmd;a.range.selectNodeContents(a.doc.body).collapse(false);a.select()}return this},sync:function(){V(this.srcElement,this.html());return this},focus:function(){this.isCreated?this.edit.focus():this.srcElement[0].focus();return this},blur:function(){this.isCreated?this.edit.blur():this.srcElement[0].blur();return this},addBookmark:function(c){c=d(c,true);var a=this,g=a.edit,f=g.doc.body,h=sb(f.innerHTML),b;if(c&&a._undoStack.length>0){var i=a._undoStack[a._undoStack.length-1];if(Math.abs(h.length-C(i.html).length)<a.minChangeSize)return a}if(g.designMode&&!a._firstAddBookmark){var e=a.cmd.range;b=e.createBookmark(true);b.html=sb(f.innerHTML);e.moveToBookmark(b)}else b={html:h};a._firstAddBookmark=false;Ob(a._undoStack,b);return a},undo:function(){return kc.call(this,this._undoStack,this._redoStack)},redo:function(){return kc.call(this,this._redoStack,this._undoStack)},fullscreen:function(a){this.fullscreenMode=a===c?!this.fullscreenMode:a;return this.remove().create()},readonly:function(a){a=d(a,true);var c=this,f=c.edit,g=f.doc;if(c.designMode)c.toolbar.disableAll(a,[]);else b(c.noDisableItems,function(){c.toolbar[a?"disable":"enable"](this)});if(e)g.body.contentEditable=!a;else g.designMode=a?"off":"on";f.textarea[0].disabled=a},createMenu:function(a){var b=this,g=a.name,e=b.toolbar.get(g),f=e.pos();a.x=f.x;a.y=f.y+e.height();a.z=b.options.zIndex;a.shadowMode=d(a.shadowMode,b.shadowMode);if(a.selectedColor!==c){a.cls="ke-colorpicker-"+b.themeType;a.noColor=b.lang("noColor");b.menu=dc(a)}else{a.cls="ke-menu-"+b.themeType;a.centerLineMode=false;b.menu=Mb(a)}return b.menu},hideMenu:function(){this.menu.remove();this.menu=null;return this},hideContextmenu:function(){this.contextmenu.remove();this.contextmenu=null;return this},createDialog:function(b){var a=this,h=b.name;b.z=a.options.zIndex;b.shadowMode=d(b.shadowMode,a.shadowMode);b.closeBtn=d(b.closeBtn,{name:a.lang("close"),click:function(){a.hideDialog();e&&a.cmd&&a.cmd.select()}});b.noBtn=d(b.noBtn,{name:a.lang(b.yesBtn?"no":"close"),click:function(){a.hideDialog();e&&a.cmd&&a.cmd.select()}});if(a.dialogAlignType!="page")b.alignEl=a.container;b.cls="ke-dialog-"+a.themeType;if(a.dialogs.length>0){var g=a.dialogs[0],c=a.dialogs[a.dialogs.length-1];g.setMaskIndex(c.z+2);b.z=c.z+3;b.showMask=false}var f=wc(b);a.dialogs.push(f);return f},hideDialog:function(){var a=this;a.dialogs.length>0&&a.dialogs.pop().remove();if(a.dialogs.length>0){var c=a.dialogs[0],b=a.dialogs[a.dialogs.length-1];c.setMaskIndex(b.z-1)}return a},errorDialog:function(f){var c=this,e=c.createDialog({width:750,title:c.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'}),d=a("iframe",e.div),b=a.iframeDoc(d);b.open();b.write(f);b.close();a(b.body).css("background-color","#FFF");d[0].contentWindow.focus();return c}};function hd(a){return new ab(a)}_instances=[];function vc(i,c){c=c||{};c.basePath=d(c.basePath,a.basePath);c.themesPath=d(c.themesPath,c.basePath+"themes/");c.langPath=d(c.langPath,c.basePath+"lang/");c.pluginsPath=d(c.pluginsPath,c.basePath+"plugins/");if(d(c.loadStyleMode,a.options.loadStyleMode)){var g=d(c.themeType,a.options.themeType);Bb(c.themesPath+"default/default.css");Bb(c.themesPath+g+"/"+g+".css")}function h(a){b(E,function(c,b){b.call(a,KindEditor)});return a.create()}var f=a(i);if(!f||f.length===0)return;if(f.length>1){f.each(function(){vc(this,c)});return _instances[0]}c.srcElement=f[0];var e=new ab(c);_instances.push(e);if(r[e.langType])return h(e);xb(e.langPath+e.langType+".js?ver="+encodeURIComponent(a.DEBUG?ob:mb),function(){h(e)});return e}function hc(b,c){a(b).each(function(d,b){a.each(_instances,function(d,a){if(a&&a.srcElement[0]==b){c.call(a,d,a);return false}})})}a.remove=function(a){hc(a,function(a){this.remove();_instances.splice(a,1)})};a.sync=function(a){hc(a,function(){this.sync()})};e&&j<7&&v(document,"BackgroundImageCache",true);a.EditorClass=ab;a.editor=hd;a.create=vc;a.instances=_instances;a.plugin=yc;a.lang=Dc;yc("core",function(g){var a=this,h={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};a.afterSetHtml(function(){a.options.afterChange&&a.options.afterChange.call(a)});a.afterCreate(function(){if(a.syncType!="form")return;var b=g(a.srcElement),d=false;while(b=b.parent())if(b.name=="form"){d=true;break}if(d){b.bind("submit",function(){a.sync();g(k).bind("unload",function(){a.edit.textarea.remove()})});var c=g('[type="reset"]',b);c.click(function(){a.html(a.initContent);a.cmd.selection()});a.beforeRemove(function(){b.unbind();c.unbind()})}});a.clickToolbar("source",function(){if(a.edit.designMode){a.toolbar.disableAll(true);a.edit.design(false);a.toolbar.select("source")}else{a.toolbar.disableAll(false);a.edit.design(true);a.toolbar.unselect("source");a.cmd.selection()}a.designMode=a.edit.designMode});a.afterCreate(function(){!a.designMode&&a.toolbar.disableAll(true).select("source")});a.clickToolbar("fullscreen",function(){a.fullscreen()});if(a.fullscreenShortcut){var i=false;a.afterCreate(function(){g(a.edit.doc,a.edit.textarea).keyup(function(b){b.which==27&&setTimeout(function(){a.fullscreen()},0)});if(i){if(e&&!a.designMode)return;a.focus()}if(!i)i=true})}b("undo,redo".split(","),function(c,b){h[b]&&a.afterCreate(function(){Kb(this.edit.doc,h[b],function(){a.clickToolbar(b)})});a.clickToolbar(b,function(){a[b]()})});a.clickToolbar("formatblock",function(){var e=a.lang("formatblock.formatBlock"),c={h1:28,h2:24,h3:18,H4:14,p:12},d=a.cmd.val("formatblock"),f=a.createMenu({name:"formatblock",width:a.langType=="en"?200:150});b(e,function(b,g){var e="font-size:"+c[b]+"px;";if(b.charAt(0)==="h")e+="font-weight:bold;";f.addItem({title:'<span style="'+e+'" unselectable="on">'+g+"</span>",height:c[b]+12,checked:d===b||d===g,click:function(){a.select().exec("formatblock","<"+b+">").hideMenu()}})})});a.clickToolbar("fontname",function(){var c=a.cmd.val("fontname"),d=a.createMenu({name:"fontname",width:150});b(a.lang("fontname.fontName"),function(b,e){d.addItem({title:'<span style="font-family: '+b+';" unselectable="on">'+e+"</span>",checked:c===b.toLowerCase()||c===e.toLowerCase(),click:function(){a.exec("fontname",b).hideMenu()}})})});a.clickToolbar("fontsize",function(){var c=a.cmd.val("fontsize"),d=a.createMenu({name:"fontsize",width:150});b(a.fontSizeTable,function(e,b){d.addItem({title:'<span style="font-size:'+b+';" unselectable="on">'+b+"</span>",height:f(b)+12,checked:c===b,click:function(){a.exec("fontsize",b).hideMenu()}})})});b("forecolor,hilitecolor".split(","),function(c,b){a.clickToolbar(b,function(){a.createMenu({name:b,selectedColor:a.cmd.val(b)||"default",colors:a.colorTable,click:function(c){a.exec(b,c).hideMenu()}})})});b("cut,copy,paste".split(","),function(c,b){a.clickToolbar(b,function(){a.focus();try{a.exec(b,null)}catch(c){alert(a.lang(b+"Error"))}})});a.clickToolbar("about",function(){var b='<div style="margin:20px;"><div>KindEditor '+mb+'</div><div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div></div>';a.createDialog({name:"about",width:350,title:a.lang("about"),body:b})});a.plugin.getSelectedLink=function(){return a.cmd.commonAncestor("a")};a.plugin.getSelectedImage=function(){return P(a.edit.cmd.range,function(a){return!/^ke-\w+$/i.test(a[0].className)})};a.plugin.getSelectedFlash=function(){return P(a.edit.cmd.range,function(a){return a[0].className=="ke-flash"})};a.plugin.getSelectedFlv=function(){return P(a.edit.cmd.range,function(a){return a[0].className=="ke-flv"})};a.plugin.getSelectedMedia=function(){return P(a.edit.cmd.range,function(a){return a[0].className=="ke-media"||a[0].className=="ke-rm"})};a.plugin.getSelectedAnchor=function(){return P(a.edit.cmd.range,function(a){return a[0].className=="ke-anchor"})};b("link,image,flash,flv,media,anchor".split(","),function(f,d){var e=d.charAt(0).toUpperCase()+d.substr(1);b("edit,delete".split(","),function(f,b){a.addContextmenu({title:a.lang(b+e),click:function(){a.loadPlugin(d,function(){a.plugin[d][b]();a.hideMenu()})},cond:a.plugin["getSelected"+e],width:150,iconClass:b=="edit"?"ke-icon-"+d:c})});a.addContextmenu({title:"-"})});a.plugin.getSelectedTable=function(){return a.cmd.commonAncestor("table")};a.plugin.getSelectedRow=function(){return a.cmd.commonAncestor("tr")};a.plugin.getSelectedCell=function(){return a.cmd.commonAncestor("td")};b("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,rowsplit,colsplit,coldelete,rowdelete,insert,delete".split(","),function(d,b){var c=w(b,["prop","delete"])<0?a.plugin.getSelectedCell:a.plugin.getSelectedTable;a.addContextmenu({title:a.lang("table"+b),click:function(){a.loadPlugin("table",function(){a.plugin.table[b]();a.hideMenu()})},cond:c,width:170,iconClass:"ke-icon-table"+b})});a.addContextmenu({title:"-"});b("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,italic,underline,strikethrough,removeformat,unlink".split(","),function(c,b){h[b]&&a.afterCreate(function(){Kb(this.edit.doc,h[b],function(){a.cmd.selection();a.clickToolbar(b)})});a.clickToolbar(b,function(){a.focus().exec(b,null)})});a.afterCreate(function(){var d=a.edit.doc,c,f,b,i="__kindeditor_paste__",h=false;function j(){c.range.moveToBookmark(f);c.select();if(H){g("div."+i,b).each(function(){g(this).after("<br />").remove(true)});g("span.Apple-style-span",b).remove(true);g("span.Apple-tab-span",b).remove(true);g("span[style]",b).each(function(){g(this).css("white-space")=="nowrap"&&g(this).remove(true)});g("meta",b).remove()}var d=b[0].innerHTML;b.remove();if(d==="")return;if(H)d=d.replace(/(<br>)\1/ig,"$1");if(a.pasteType===2){d=d.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/ig,"");if(/schemas-microsoft-com|worddocument|mso-\w+/i.test(d))d=cc(d,a.filterMode?a.htmlTags:g.options.htmlTags);else{d=D(d,a.filterMode?a.htmlTags:null);d=a.beforeSetHtml(d)}}if(a.pasteType===1){d=d.replace(/&nbsp;/ig," ");d=d.replace(/\n\s*\n/g,"\n");d=d.replace(/<br[^>]*>/ig,"\n");d=d.replace(/<\/p><p[^>]*>/ig,"\n");d=d.replace(/<[^>]+>/g,"");d=d.replace(/ {2}/g," &nbsp;");if(a.newlineTag=="p"){if(/\n/.test(d))d=d.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")}else d=d.replace(/\n/g,"<br />$&")}a.insertHtml(d,true)}g(d.body).bind("paste",function(l){if(a.pasteType===0){l.stop();return}if(h)return;h=true;g("div."+i,d).remove();c=a.cmd.selection();f=c.range.createBookmark();b=g('<div class="'+i+'"></div>',d).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:g(f.start).pos().y+"px","white-space":"nowrap"});g(d.body).append(b);if(e){var k=c.range.get(true);k.moveToElementText(b[0]);k.select();k.execCommand("paste");l.preventDefault()}else{c.range.selectNodeContents(b[0]);c.select()}setTimeout(function(){j();h=false},0)})});a.beforeGetHtml(function(a){if(e&&j<=8){a=a.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/ig,function(b,a){return unescape(a)});a=a.replace(/(<input)((?:\s+[^>]*)?>)/ig,function(a,b,c){return!/\s+type="[^"]+"/i.test(a)?b+' type="text"'+c:a})}return a.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/ig,function(d,a,b,c){return a+X(b).replace(/\s+/g," ")+c}).replace(/<img[^>]*class="?ke-(flash|flv|rm|media)"?[^>]*>/ig,function(e){var a=q(e),c=L(a.style||""),b=jc(a["data-ke-tag"]);b.width=d(a.width,f(d(c.width,"")));b.height=d(a.height,f(d(c.height,"")));return yb(b)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/ig,function(b){var a=q(b);return'<a name="'+unescape(a["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/ig,function(c,a,b){return"<script"+unescape(a)+">"+unescape(b)+"<\/script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/ig,function(c,a,b){return"<noscript"+unescape(a)+">"+unescape(b)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/ig,function(a,c,b){a=a.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(d,a,c){return a+X(b)+c});a=a.replace(/\s+data-ke-src="[^"]*"/i,"");return a}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/ig,function(c,a,b){return a+b})});a.beforeSetHtml(function(b){if(e&&j<=8)b=b.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/ig,function(a){var c=q(a),b=L(c.style||"");return b.display=="none"?'<div class="ke-display-none" data-ke-input-tag="'+escape(a)+'"></div>':a});return b.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/ig,function(c){var b=q(c);b.src=d(b.src,"");b.width=d(b.width,0);b.height=d(b.height,0);return pc(a.themesPath+"common/blank.gif",b)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/ig,function(d){var b=q(d);return b.href!==c?d:'<img class="ke-anchor" src="'+a.themesPath+'common/anchor.gif" data-ke-name="'+escape(b.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/ig,function(c,a,b){return'<div class="ke-script" data-ke-script-attr="'+escape(a)+'">'+escape(b)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/ig,function(c,a,b){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(a)+'">'+escape(b)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/ig,function(a,c,e,b,d){if(a.match(/\sdata-ke-src="[^"]*"/i))return a;a=c+e+'="'+b+'" data-ke-src="'+l(b)+'"'+d;return a}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/ig,function(c,a,b){return a+"data-ke-"+b}).replace(/<table[^>]*\s+border="0"[^>]*>/ig,function(a){return a.indexOf("ke-zeroborder")>=0?a:Mc(a,"ke-zeroborder")})})})})(window)